# Milestone v1.0: Base Claiming System

**Status:** SHIPPED 2026-01-17
**Phases:** 1-5 (+ 4.1, 4.2 inserted)
**Total Plans:** 13

## Overview

Implementation of the base claiming system that enforces risk-based territorial progression. Players must explore to find bells that grant land plots, which can be used to claim flat chunks as safe building areas. Outside these bases, strict placement restrictions and mining fatigue penalties force players into risk/reward decisions. The system includes village protection, combat restrictions in bases, and comprehensive testing.

## Phases

### Phase 1: Land Plot System

**Goal**: Players can obtain land plot books from bells to enable chunk claiming
**Depends on**: Nothing (first phase)
**Requirements**: PLOT-01, PLOT-02, PLOT-03, PLOT-04
**Success Criteria** (what must be TRUE):
  1. Bell rings drop land plot books on first activation
  2. Multiple land plot books can be collected from different bells across the world
  3. Bells no longer appear in villager trades
  4. Bell activation state persists across server restarts and world reloads
**Plans**: 2 plans in 2 waves
**Status**: Complete (2026-01-15)

Plans:
- [x] 01-01: Land plot item foundation (Wave 1)
- [x] 01-02: Bell interaction + state persistence (Wave 2)

### Phase 2: Chunk Claiming Core

**Goal**: Players can use land plot books to claim valid chunks as base areas
**Depends on**: Phase 1
**Requirements**: CLAIM-01, CLAIM-02, CLAIM-03, CLAIM-04, CLAIM-05, CLAIM-06, CLAIM-07, CLAIM-08
**Success Criteria** (what must be TRUE):
  1. Player can use land plot book on a block to claim the containing chunk
  2. Claiming fails appropriately with feedback (uneven terrain, village chunks, already claimed)
  3. Base area boundaries are correctly calculated (y >= lowest surface - 10) and tracked
  4. Village chunks are properly detected using structure/feature API
  5. Land plot book is consumed on successful claim
**Plans**: 3 plans in 2 waves
**Status**: Complete (2026-01-16)

Plans:
- [x] 02-01: Claim data storage (Wave 1)
- [x] 02-02: Chunk validator (Wave 1)
- [x] 02-03: Land plot use action (Wave 2)

### Phase 3: Base Area Permissions

**Goal**: Base areas provide unrestricted building with combat restrictions
**Depends on**: Phase 2
**Requirements**: BASE-01, BASE-02, BASE-03, BASE-04, BASE-05, BASE-06
**Success Criteria** (what must be TRUE):
  1. Player can place any block type within base area without restrictions
  2. Player can break any block within base area without restrictions or mining fatigue
  3. Player cannot attack or draw weapons while inside their base area
  4. "No violence indoors!" message appears (red text) when attempting combat in base
**Plans**: 1 plan in 1 wave
**Status**: Complete (2026-01-16)

Plans:
- [x] 03-01: Base area permissions with combat blocking

### Phase 4: World Restrictions

**Goal**: Outside bases, strict placement rules and mining fatigue enforce risk
**Depends on**: Phase 3
**Requirements**: PLACE-01, PLACE-02, PLACE-03, PLACE-04, PLACE-05, BREAK-01, BREAK-02, BREAK-03, BREAK-04, BREAK-05, BREAK-06, BREAK-07
**Success Criteria** (what must be TRUE):
  1. Only allowlist blocks can be placed outside base chunks (silently fails otherwise)
  2. Allowlist blocks (except torches/ladders) respect 26-coordinate adjacency restriction
  3. Mining fatigue applies when breaking blocks outside bases with 1.4^x stacking
  4. Mining fatigue decays one level every 12 seconds with correct duration display
  5. Village chunks are protected (no block breaking except ores and allowlist blocks)
**Plans**: 4 plans in 4 waves
**Status**: Complete (2026-01-16)

Plans:
- [x] 04-01: Block placement restrictions with allowlist
- [x] 04-02: Mining fatigue stacking system
- [x] 04-03: Village protection handler
- [x] 04-04: Mining fatigue decay handler

### Phase 4.1: Bug Fixes (INSERTED)

**Goal**: Fix bugs discovered during gameplay testing
**Depends on**: Phase 4
**Requirements**: None (fixes for existing requirements)
**Success Criteria** (what must be TRUE):
  1. Land plot item displays correct custom texture (land_plot.png) in inventory and when held
  2. Bells cannot be broken by players (infinite hardness protection)
  3. Block placement rejection does not cause inventory desync (count doesn't flicker)
  4. Blocks in village chunks cannot be broken (except ores and allowlist blocks)
**Plans**: 1 plan in 1 wave
**Status**: Complete (2026-01-16)

Plans:
- [x] 04.1-01: Fix land plot icon, bell protection, inventory sync, village detection

### Phase 4.2: Bug Fixes 2 (INSERTED)

**Goal**: Fix bell hardness (bedrock-like) and village chunk detection
**Depends on**: Phase 4.1
**Requirements**: None (fixes for existing requirements)
**Success Criteria** (what must be TRUE):
  1. Bells have bedrock-like hardness (mining never starts, 0 progress)
  2. Village chunks are reliably detected across all chunks the village spans
**Plans**: 1 plan in 1 wave
**Status**: Complete (2026-01-16)

Plans:
- [x] 04.2-01: Bell mixin, village detection fix

### Phase 5: Crafting Tweaks

**Goal**: Quality of life crafting and stacking changes for ladders and snow
**Depends on**: Phase 4.2
**Requirements**: CRAFT-01, CRAFT-02, CRAFT-03, CRAFT-04
**Success Criteria** (what must be TRUE):
  1. Ladder recipe yields 16 ladders from 7 sticks (instead of 3)
  2. Snowballs stack to 64 (instead of 16)
  3. Snow block can be crafted into 9 snowballs
  4. 9 snowballs can be crafted into 1 snow block
**Plans**: 1 plan in 1 wave
**Status**: Complete (2026-01-17)

Plans:
- [x] 05-01: Crafting tweaks (ladder, snowball stack, snow conversion)

---

## Milestone Summary

**Decimal Phases:**
- Phase 4.1: Bug Fixes (inserted after Phase 4 for gameplay-discovered bugs)
- Phase 4.2: Bug Fixes 2 (inserted after Phase 4.1 for bell hardness and village detection)

**Key Decisions:**
- Land plot book non-stackable (stacksTo(1)) — maintains scarcity
- Bell activation stored on block entity — per-bell independence
- SavedDataType with Codec (1.21.11 pattern) — modern API
- StructureTags.VILLAGE for village detection — single tag covers all variants
- Multi-position sampling (63-point) for village detection — reliable coverage
- Block allowlist strategy: 34 essential utility blocks
- Adjacency rule = 26 neighboring blocks (3x3x3 minus center)
- Mining fatigue 1.4^x stacking with 12-second decay per level
- Mixin over event handler for bell protection — prevents mining animation
- Accessor mixin for item component modification (MC 1.21+ immutability)

**Issues Resolved:**
- Land plot texture not displaying (fixed with model + item definition)
- Bell could be broken (fixed with bedrock-like mixin)
- Inventory desync on placement rejection (fixed with sendAllDataToRemote)
- Village detection inconsistent (fixed with 63-point sampling)

**Issues Deferred:**
- None

**Technical Debt Incurred:**
- None identified

---

*For current project status, see .planning/ROADMAP.md*
