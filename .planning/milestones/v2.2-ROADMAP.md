# Milestone v2.2: Extra Features Batch 6

**Status:** SHIPPED 2026-01-23
**Phases:** 30-36
**Total Plans:** 9

## Overview

Food economy overhaul establishing cooking progression gates and meaningful food choices, plus foundational class/stage system for multiplayer role differentiation. Smokers gated behind iron, apples available from all leaves at 5x rate, complete food stat rebalancing, and new foods (Hearty Stew, Honey Apple). Class system introduces permanent role selection with health/damage modifiers, and stage system provides scaffolding for future boon progression.

## Phases

### Phase 30: Smoker Gating

**Goal**: Gate smoker behind iron acquisition
**Depends on**: Nothing (first phase)
**Plans**: 1 plan

Plans:
- [x] 30-01: Remove vanilla smoker recipe, add iron-gated recipe, filter from villages

**Details:**
- Smoker recipe requires 2 iron ingots in top corners
- Smokers do not spawn naturally in villages
- Existing smoker functionality unchanged

**Completed:** 2026-01-22

### Phase 31: Apple & Bonemeal

**Goal**: Improve early-game food availability and farming
**Depends on**: Phase 30
**Plans**: 1 plan

Plans:
- [x] 31-01: Universal apple drops, instant crop maturation, doubled bonemeal yield

**Details:**
- Apples drop from any leaf type (oak, birch, spruce, jungle, acacia, dark oak, cherry, azalea, mangrove)
- Apple drop rate is 5x vanilla (2.5% base)
- Bonemeal fully matures any crop in one use
- Bone crafts into 6 bonemeal (not 3)

**Completed:** 2026-01-22

### Phase 32: Food Removals

**Goal**: Remove low-value food items to simplify food choices
**Depends on**: Phase 31
**Plans**: 1 plan

Plans:
- [x] 32-01: Remove suspicious stew, mushroom stew, beetroot soup, sugarcane→sugar recipes

**Details:**
- Four low-value food recipes removed via RecipeManagerMixin filtering
- Simplifies food progression choices

**Completed:** 2026-01-22

### Phase 33: Food Stats

**Goal**: Complete hunger/saturation rebalancing per design table
**Depends on**: Phase 32
**Plans**: 1 plan

Plans:
- [x] 33-01: Rebalance 29 vanilla foods using DefaultItemComponentEvents.MODIFY

**Details:**
- Raw meats: low hunger (2-3), zero saturation
- Cooked meats: high hunger (5-8), moderate saturation (1.6-1.8)
- Crops/vegetables: low-moderate hunger (1-5), low saturation (0-0.7)
- Golden foods: moderate hunger (4-6), very high saturation (8-10)
- All food values match design specification for saturation-tiered healing

**Completed:** 2026-01-23

### Phase 34: New Foods

**Goal**: Add Hearty Stew and Honey Apple
**Depends on**: Phase 33
**Plans**: 1 plan

Plans:
- [x] 34-01: Hearty Stew rename, Honey Apple item with custom texture and recipe

**Details:**
- Rabbit stew renamed to "Hearty Stew" (10 hunger, 6.36 saturation)
- Honey Apple craftable (apple + honey bottle shapeless, yields 8)
- Honey Apple provides 8 hunger, 2.73 saturation
- Custom honey_apple.png texture

**Completed:** 2026-01-23

### Phase 35: Class System

**Goal**: Implement permanent class selection with role modifiers
**Depends on**: Phase 34
**Plans**: 2 plans

Plans:
- [x] 35-01: Class foundation - attachment, enum, manager, /selectClass command
- [x] 35-02: Damage modification - melee and ranged multipliers in mixins

**Details:**
- /selectClass <tank|melee|ranged|support> command (base chunks only)
- Tank: +1 heart max health, x2.5 melee damage, x1 ranged damage
- Melee: +0.5 hearts max health, x4 melee damage, x1 ranged damage
- Ranged: no health change, x1 melee damage, x5 ranged damage
- Support: no health change, x1 melee damage, x3 ranged damage
- Class selection is permanent (cannot change once selected)
- Class persists across sessions and death

**Completed:** 2026-01-23

### Phase 36: Stage System

**Goal**: Server-wide stage progression with per-player boon tracking
**Depends on**: Phase 35
**Plans**: 2 plans

Plans:
- [x] 36-01: Stage foundation - StageData SavedData, BOON_LEVEL attachment, StageManager
- [x] 36-02: Command and events - /advanceStage command, late-joiner boon initialization

**Details:**
- /advanceStage command advances server to next stage (1→2→3→4→5)
- Stage is server-wide (all players on same stage)
- Each player's boon level increments when stage advances
- Boon level tracked per-player with their class
- Class + boon level persist across server restarts
- Late-joiners get current stage as starting boon level

**Completed:** 2026-01-23

---

## Milestone Summary

**Key Decisions:**
- DefaultItemComponentEvents.MODIFY for vanilla item component modification at startup
- FoodProperties.Builder saturationModifier formula: targetSat / (nutrition * 2)
- Persistent string attachment for player class selection (PLAYER_CLASS)
- Class selection permanence via hasClass() check in setClass()
- Post-reduction multiplier application: class multipliers applied after base damage reduction
- Integer attachment with copyOnDeath: BOON_LEVEL persistent state surviving respawn
- Minecraft 1.21.11 permission system: Permissions.COMMANDS_GAMEMASTER replaces hasPermissionLevel()
- Late-joiner initialization: JOIN event with hasClass() check to distinguish new vs returning players

**Issues Resolved:**
- Incorrect MC 1.21 item names (RAW_BEEF → BEEF, etc.)
- FoodProperties API changes in MC 1.21+ (effects moved to CONSUMABLE component)
- Permission API changes in MC 1.21.11 (hasPermissionLevel removed)

**Issues Deferred:**
- PlayerSleepMixin broken from MC 1.21.11 upgrade (blocks smoke test, not functionality)

**Technical Debt Incurred:**
- None identified

---

_For current project status, see .planning/ROADMAP.md_
