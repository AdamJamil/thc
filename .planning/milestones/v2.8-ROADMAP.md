# Roadmap: THC v2.8 Villager Overhaul

## Overview

This milestone transforms the vanilla villager trading system into a curated, stage-gated progression mechanic. Villagers are restricted to 4 useful professions (mason, librarian, butcher, cartographer), automatic leveling is replaced with manual emerald-cost advancement tied to the stage system, and deterministic trade tables replace random pools. Structure locator items give cartographers end-game utility, and rail recipe improvements support infrastructure building.

## Phases

**Phase Numbering:**
- Continues from v2.7 (phases 62-65)
- v2.8 covers phases 66-71

- [x] **Phase 66: Structure Locators** - Custom compass-style items pointing to structures
- [x] **Phase 67: Job Restriction** - Limit villagers to 4 allowed professions
- [x] **Phase 68: Custom Trade Tables** - Deterministic trades for all 4 professions
- [x] **Phase 69: Manual Leveling** - Stage-gated emerald advancement
- [x] **Phase 70: Trade Cycling** - Reroll current rank trades with emerald
- [ ] **Phase 71: Rail Transportation** - Copper alternative and yield increases

## Phase Details

### Phase 66: Structure Locators
**Goal**: Players can obtain and use compass-style items that point to specific structures
**Depends on**: Nothing (independent foundation for cartographer trades)
**Requirements**: SLOC-01, SLOC-02, SLOC-03, SLOC-04, SLOC-05, SLOC-06, SLOC-07, SLOC-08, SLOC-09, SLOC-10
**Success Criteria** (what must be TRUE):
  1. Player holding a structure locator sees needle point toward nearest matching structure
  2. Locators work correctly in their intended dimension (Overworld/Nether)
  3. Structure search completes without noticeable lag (100 chunk cap)
  4. All 6 structure types have distinct locator items with custom textures
**Plans**: 2 plans

Plans:
- [x] 66-01-PLAN.md — StructureLocatorItem base class + 6 item registrations
- [x] 66-02-PLAN.md — Item model definitions, 96 directional models/textures, lang entries

### Phase 67: Job Restriction
**Goal**: Villagers can only have mason, librarian, butcher, or cartographer professions
**Depends on**: Nothing (independent restriction layer)
**Requirements**: VJOB-01, VJOB-02, VJOB-03, VJOB-04
**Success Criteria** (what must be TRUE):
  1. Villagers near disallowed job blocks (brewing stand, smithing table, etc.) remain jobless
  2. Naturally spawned villagers with disallowed professions become unemployed
  3. Zombie villager cures cannot result in disallowed professions
  4. Only lecterns, smokers, stonecutter, and cartography tables grant professions
**Plans**: 2 plans

Plans:
- [x] 67-01-PLAN.md — AllowedProfessions helper + VillagerProfessionMixin (data layer restriction)
- [x] 67-02-PLAN.md — ServerLevelPoiMixin extension (world layer POI blocking)

### Phase 68: Custom Trade Tables
**Goal**: All 4 allowed professions have deterministic, curated trade tables
**Depends on**: Phase 66 (structure locators needed for cartographer trades)
**Requirements**: TLIB-01 through TLIB-09, TBUT-01 through TBUT-08, TMAS-01 through TMAS-10, TCRT-01 through TCRT-10
**Success Criteria** (what must be TRUE):
  1. Librarian offers enchanted books in predictable slots with 50/50 variants
  2. Butcher trades raw meat for emeralds and sells cooked food
  3. Mason sells 64-stack building blocks with predictable variants
  4. Cartographer sells structure locators at appropriate levels
  5. No vanilla random trade pools remain for these 4 professions
**Plans**: 3 plans

Plans:
- [x] 68-01-PLAN.md — CustomTradeTables foundation + VillagerTradesMixin interception
- [x] 68-02-PLAN.md — Librarian trades (enchanted books with 50/50 variants)
- [x] 68-03-PLAN.md — Butcher, Mason, Cartographer trades (structure locators)

### Phase 69: Manual Leveling
**Goal**: Villager levels require manual emerald payment with stage gates
**Depends on**: Phase 68 (trade tables define what unlocks at each level)
**Requirements**: VLEV-01, VLEV-02, VLEV-03, VLEV-04, VLEV-05
**Success Criteria** (what must be TRUE):
  1. Villagers do not level up automatically from trading
  2. Right-click with emerald at max XP triggers level up
  3. Level up requires matching stage (Stage 2 for Apprentice, etc.)
  4. Emerald is consumed on successful level up
  5. Reduced XP per level (2/3/4/5 trades to max XP at each tier)
**Plans**: 2 plans

Plans:
- [x] 69-01-PLAN.md — Disable automatic leveling and modify XP thresholds
- [x] 69-02-PLAN.md — UseEntityCallback for manual level up with stage gates

### Phase 70: Trade Cycling
**Goal**: Players can reroll current-rank trades by paying emerald
**Depends on**: Phase 68 (trade tables provide deterministic reroll options)
**Requirements**: VCYC-01, VCYC-02, VCYC-03
**Success Criteria** (what must be TRUE):
  1. Right-click with emerald at 0 XP rerolls current level trades
  2. Earlier rank trades are preserved during cycling
  3. Emerald is consumed on successful cycle
  4. GUI properly syncs after trade modification
**Plans**: 1 plan

Plans:
- [x] 70-01-PLAN.md — Trade cycling via UseEntityCallback (0 XP reroll with pool size check)

### Phase 71: Rail Transportation
**Goal**: Rails are cheaper and craftable with copper
**Depends on**: Nothing (independent quality-of-life)
**Requirements**: RAIL-01, RAIL-02, RAIL-03
**Success Criteria** (what must be TRUE):
  1. Rails craftable with copper ingots (alternative to iron)
  2. Rail recipe yields 64 per craft (4x vanilla)
  3. Powered rail recipe yields 64 per craft (~10x vanilla)
**Plans**: 1 plan

Plans:
- [ ] 71-01-PLAN.md — Rail and powered rail recipe overrides with copper alternative

## Progress

**Execution Order:**
Phases execute in numeric order: 66 -> 67 -> 68 -> 69 -> 70 -> 71

| Phase | Plans Complete | Status | Completed |
|-------|----------------|--------|-----------|
| 66. Structure Locators | 2/2 | Complete | 2026-01-31 |
| 67. Job Restriction | 2/2 | Complete | 2026-01-31 |
| 68. Custom Trade Tables | 3/3 | Complete | 2026-01-31 |
| 69. Manual Leveling | 2/2 | Complete | 2026-01-31 |
| 70. Trade Cycling | 1/1 | Complete | 2026-01-31 |
| 71. Rail Transportation | 0/1 | Not started | - |

**Total:** 6 phases, 11 plans estimated

---

*Roadmap created: 2026-01-30*
*Milestone: v2.8 Villager Overhaul*
