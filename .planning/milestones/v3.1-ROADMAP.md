# Milestone v3.1: Bastion

**Status:** Active
**Phases:** 75-79
**Total Plans:** 7 (Phases 75-79 planned)

## Overview

Introduce Bastion class identity through stage-gated boons that reward progression with unique defensive and crowd-control capabilities. Tank class is renamed to Bastion, and four boons unlock at stages 2-5 giving Bastion exclusive access to bucklers, parry aggro propagation, enhanced snowballs, and boat mastery.

## Phases

### Phase 75: Rename

**Goal**: Replace all Tank references with Bastion throughout codebase and UI
**Depends on**: None
**Requirements**: RNAM-01
**Plans:** 1 plan

Plans:
- [x] 75-01-PLAN.md — Rename TANK enum to BASTION, update command suggestion

**Success Criteria:**
1. `/selectClass bastion` works (not `/selectClass tank`)
2. Class selection UI shows "Bastion" for the tank role
3. No references to "Tank" remain in player-facing text or commands

**Details:**
- Code refactoring: variable names, enum values, file names
- UI text updates: class selection, status displays
- Command registration: `/selectClass bastion` replaces `/selectClass tank`

---

### Phase 76: Boon 1 - Buckler Gate

**Goal**: Restrict buckler usage to Bastion class at Stage 2+
**Depends on**: Phase 75 (Bastion class exists)
**Requirements**: BUCK-01, BUCK-02, BUCK-03
**Plans:** 1 plan

Plans:
- [ ] 76-01-PLAN.md — Add class + stage gate to BucklerItem.use()

**Success Criteria:**
1. Bastion at Stage 1 cannot raise buckler (sees action bar message)
2. Bastion at Stage 2+ can raise and use buckler normally
3. Non-Bastion classes cannot raise buckler at any stage (sees action bar message)
4. Buckler parry, poise, and damage reduction work normally once raised

**Details:**
- Buckler raise interception (existing buckler system)
- Class check via ClassManager.getPlayerClass()
- Stage check via StageManager.getBoonLevel()
- Action bar message: "Your wimpy arms cannot lift the buckler."

---

### Phase 77: Boon 2 - Parry Aggro & Sweeping

**Goal**: Enable threat propagation and sweeping edge for Bastion at Stage 3+
**Depends on**: Phase 76 (buckler gate establishes boon pattern)
**Requirements**: PRRY-01, PRRY-02, PRRY-03
**Plans:** 1 plan

Plans:
- [ ] 77-01-PLAN.md — Create BoonGate utility, add parry threat propagation, enable conditional sweeping

**Success Criteria:**
1. Bastion at Stage 3+ successful parry propagates threat to nearby mobs
2. Bastion at Stage 3+ melee attacks apply sweeping damage to adjacent enemies
3. Non-Bastion classes still have sweeping edge disabled (no change to current behavior)
4. Bastion at Stage 1-2 does not get parry aggro or sweeping

**Details:**
- Parry threat propagation hook (existing threat system)
- Sweeping edge conditional enable (currently globally disabled)
- Class + stage gate checks at both interaction points

---

### Phase 78: Boon 3 - Snowball Enhancement

**Goal**: Enhance snowball hits with AoE slowness and knockback for Bastion at Stage 4+
**Depends on**: None (independent combat enhancement)
**Requirements**: SNOW-01, SNOW-02, SNOW-03, SNOW-04, SNOW-05
**Plans:** 1 plan

Plans:
- [ ] 78-01-PLAN.md — Create SnowballHitMixin with boon-gated slowness and knockback

**Success Criteria:**
1. Bastion at Stage 4+ snowball hit applies Slowness III (2s) to target
2. Bastion at Stage 4+ snowball hit applies Slowness III (2s) to mobs within 1.5 blocks of target
3. Bastion at Stage 4+ snowball hit knocks target back by ~1 block
4. Non-Bastion or lower stage snowballs deal no damage/effects (vanilla behavior)
5. Snowball hits on players unaffected (PvP unchanged)

**Details:**
- Snowball hit event handler (projectile impact)
- AoE entity query within 1.5 blocks
- Slowness III potion effect (40 ticks = 2 seconds)
- Knockback vector calculation from impact direction

---

### Phase 79: Boon 4 - Boat Mastery

**Goal**: Enable land boat placement and mob trapping for Bastion at Stage 5+
**Depends on**: None (independent feature)
**Requirements**: BOAT-01, BOAT-02, BOAT-03, BOAT-04, BOAT-05, BOAT-06, BOAT-07, BOAT-08
**Plans:** 3 plans

Plans:
- [ ] 79-01-PLAN.md — Stack size to 16, copper boat recipes (9 variants)
- [ ] 79-02-PLAN.md — Land placement gate for Bastion Stage 5+
- [ ] 79-03-PLAN.md — Hostile mob trapping with 4-second breakout

**Success Criteria:**
1. Bastion at Stage 5+ can place wooden boats on solid ground
2. Non-Bastion or lower stage cannot place boats on land (water placement unchanged)
3. Hostile mobs pushed into boats become trapped passengers
4. Trapped mobs break out after 4 seconds, boat drops as item
5. Wooden boat recipes require 2 copper ingots (all 9 variants)
6. Boats stack to 16 in inventory

**Details:**
- Boat placement validation override
- Mob passenger tracking attachment
- 4-second breakout timer (80 ticks)
- Recipe modifications for all 9 wood types
- Stack size property change

---

## Coverage Validation

| Category | Requirements | Phase | Count |
|----------|--------------|-------|-------|
| RNAM | RNAM-01 | 75 | 1 |
| BUCK | BUCK-01, BUCK-02, BUCK-03 | 76 | 3 |
| PRRY | PRRY-01, PRRY-02, PRRY-03 | 77 | 3 |
| SNOW | SNOW-01, SNOW-02, SNOW-03, SNOW-04, SNOW-05 | 78 | 5 |
| BOAT | BOAT-01, BOAT-02, BOAT-03, BOAT-04, BOAT-05, BOAT-06, BOAT-07, BOAT-08 | 79 | 8 |

**Total:** 18/18 requirements mapped (100% coverage)

---

## Milestone Summary

**Key Dependencies:**
- Phase 75 must complete first (rename establishes Bastion identity)
- Phases 76-79 can proceed in order as boons unlock at increasing stages
- Phase 77 depends on 76 for boon pattern establishment
- Phases 78 and 79 are relatively independent

**Plans by Phase:**
- Phase 75: 1 plan (rename is atomic) - COMPLETE
- Phase 76: 1 plan (buckler gate)
- Phase 77: 1 plan (parry aggro + sweeping combined)
- Phase 78: 1 plan (snowball enhancement)
- Phase 79: 3 plans (stack/recipes -> land placement -> mob trapping)

**Risk Areas:**
- Sweeping edge toggle may need careful integration with combat rebalancing
- Mob breakout timer needs proper cleanup on boat destruction

---

_For current project status, see .planning/ROADMAP.md_
