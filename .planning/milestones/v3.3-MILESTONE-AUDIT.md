---
milestone: v3.3
audited: 2026-02-11T05:00:00Z
status: gaps_found
scores:
  requirements: 10/11
  phases: 2/3
  integration: 12/13
  flows: 3/4
gaps:
  requirements:
    - "SCAL-01: Slider exists but does not control health bar/effect icon sizes (MobHealthBarConfig.getScalePercent() never called by renderer)"
  integration:
    - "Phase 85 → Phase 83: MobHealthBarConfig.getScalePercent() exported but never consumed by MobHealthBarRenderer (hardcoded BAR_WIDTH = 1.5f)"
  flows:
    - "Video Settings slider → renderer size change: slider adjusts config value but renderer ignores it"
tech_debt: []
---

# Milestone v3.3: Enemy Health Bars — Audit Report

## Overview

| Metric | Score | Details |
|--------|-------|---------|
| Requirements | 10/11 | SCAL-01 partially satisfied (slider exists but doesn't control sizes) |
| Phases | 2/3 passed | Phase 83 passed, Phase 84 human_needed, Phase 85 gaps_found |
| Integration | 12/13 | 1 orphaned export (getScalePercent) |
| E2E Flows | 3/4 | Slider → render size change broken |

## Phase Verification Summary

| Phase | Name | Status | Score | Notes |
|-------|------|--------|-------|-------|
| 83 | Health Bar Rendering | passed | 5/5 | All HBAR requirements satisfied, no gaps |
| 84 | Mob Effects Display | human_needed | 3/3 | Code verified, visual confirmation needed in-game |
| 85 | Scaling | gaps_found | 2/3 | Config created but not wired to renderer |

## Requirements Coverage

| Requirement | Description | Phase | Status |
|-------------|-------------|-------|--------|
| HBAR-01 | Hostile mobs within 32 blocks display floating health bar | 83 | ✓ SATISFIED |
| HBAR-02 | Health bar ~0.5 blocks above mob head, billboard | 83 | ✓ SATISFIED |
| HBAR-03 | health_bar_empty.png renders as base layer | 83 | ✓ SATISFIED |
| HBAR-04 | health_bar_full.png clipped to HP percentage | 83 | ✓ SATISFIED |
| HBAR-05 | health_bar_absorption.png clipped to absorption | 83 | ✓ SATISFIED |
| HBAR-06 | Health bar hidden at full HP, no effects | 83 | ✓ SATISFIED |
| MEFF-01 | Effect icons left-to-right above health bar | 84 | ✓ SATISFIED |
| MEFF-02 | Icons use same frame/icon/overlay style as effects GUI | 84 | ✓ SATISFIED |
| MEFF-03 | Duration overlay drains per tick | 84 | ✓ SATISFIED |
| SCAL-01 | Slider controls health bar and effect icon sizes | 85 | ✗ PARTIAL |
| SCAL-02 | Scaling persists to file | 85 | ✓ SATISFIED |

**Unsatisfied:** SCAL-01 — The slider exists in Video Settings and the config value persists, but `MobHealthBarConfig.getScalePercent()` is never called by `MobHealthBarRenderer`. The slider moves but health bars remain at hardcoded `BAR_WIDTH = 1.5f`.

## Cross-Phase Integration

### Connected (12 exports)

| Export | From | To | Status |
|--------|------|----|--------|
| MobHealthBarRenderer.render() | Phase 83 | THCClient.kt | ✓ WIRED |
| CameraAccessor.yRot/xRot | Phase 83 | MobHealthBarRenderer | ✓ WIRED |
| WorldRenderEvents.AFTER_ENTITIES | Phase 83 | THCClient.kt | ✓ WIRED |
| EffectsHudRenderer.FRAME_TEXTURE | Phase 84 | MobHealthBarRenderer | ✓ WIRED |
| EffectsHudRenderer.NUMERALS_TEXTURE | Phase 84 | MobHealthBarRenderer | ✓ WIRED |
| EffectsHudRenderer.effectComparator | Phase 84 | MobHealthBarRenderer | ✓ WIRED |
| EffectsHudRenderer.BASE_FRAME_SIZE | Phase 84 | MobHealthBarRenderer | ✓ WIRED |
| EffectsHudRenderer.ICON_OFFSET/SIZE | Phase 84 | MobHealthBarRenderer | ✓ WIRED |
| EffectsHudRenderer.OVERLAY_COLOR | Phase 84 | MobHealthBarRenderer | ✓ WIRED |
| MobHealthBarConfig.load() | Phase 85 | THCClient.kt | ✓ WIRED |
| MobHealthBarConfig.mobHealthBarScale | Phase 85 | VideoSettingsScreenMixin | ✓ WIRED |
| Translation key | Phase 85 | en_us.json | ✓ WIRED |

### Broken (1 export)

| Export | From | To | Issue |
|--------|------|----|-------|
| MobHealthBarConfig.getScalePercent() | Phase 85 | Phase 83 renderer | **ORPHANED** — accessor created but never called; renderer uses hardcoded BAR_WIDTH = 1.5f |

## E2E Flow Analysis

### Flow 1: Mob Health Display ✓ COMPLETE
Mob takes damage → health bar appears → HP fill shrinks → mob dies → bar disappears

### Flow 2: Mob Status Effects ✓ COMPLETE
Mob gets effect → icon appears above health bar → duration drains → effect ends → icon disappears

### Flow 3: Video Settings Persistence ✓ COMPLETE
Player opens Video Settings → sees slider → adjusts → exits → restarts → setting preserved

### Flow 4: Slider Controls Rendering ✗ BROKEN
Player adjusts slider → **health bars don't change size** → renderer ignores config value

**Break point:** MobHealthBarRenderer.kt line 39 uses `const val BAR_WIDTH = 1.5f` instead of reading from MobHealthBarConfig.getScalePercent()

## Gap Analysis

### Critical Gap: Config → Renderer Wiring

**What exists:**
- MobHealthBarConfig with getScalePercent() accessor (Phase 85)
- MobHealthBarRenderer with hardcoded BAR_WIDTH = 1.5f (Phase 83)

**What's missing:**
- MobHealthBarRenderer must call MobHealthBarConfig.getScalePercent() to compute BAR_WIDTH dynamically
- BAR_HEIGHT must derive from dynamic BAR_WIDTH
- Effect frame sizing must also scale proportionally

**Root cause:** Phase 85 created the config infrastructure but didn't integrate it into the existing renderer from Phase 83. The verifier for Phase 85 identified this gap.

### Human Verification Pending (Phase 84)

Phase 84 passed all automated checks (3/3 truths verified via code inspection) but requires in-game visual verification for:
1. Effect icon visual appearance and clarity
2. Multi-effect priority ordering (left-to-right)
3. Duration overlay drain smoothness
4. Visual consistency with player effects GUI

## Anti-Patterns

None detected across all three phases.

## Tech Debt

None identified.

---

_Audited: 2026-02-11T05:00:00Z_
_Auditor: Claude (gsd-audit-milestone)_
