# Milestone v3.3: Enemy Health Bars

**Status:** In progress
**Phases:** 83-85
**Total Plans:** TBD

## Overview

Floating health bars above hostile mobs showing current HP, absorption, and active status effects. Three-layer texture rendering (empty/full/absorption) positioned as billboards above mob heads, with mob effect icons displayed above the health bar reusing the effects GUI rendering style. A Video Settings slider controls all sizing. Builds directly on v3.2 Effects GUI patterns for HUD rendering, texture overlays, sub-tick interpolation, and scaling persistence.

## Phases

- [x] **Phase 83: Health Bar Rendering** - Three-layer floating health bar above hostile mobs with visibility gating
- [x] **Phase 84: Mob Effects Display** - Status effect icons rendered above health bar using effects GUI style
- [x] **Phase 85: Scaling** - Video Settings slider controlling health bar and effect icon sizes

## Phase Details

### Phase 83: Health Bar Rendering

**Goal**: Hostile mobs within range display a floating health bar showing current HP and absorption as layered textures
**Depends on**: Nothing (first phase)
**Requirements**: HBAR-01, HBAR-02, HBAR-03, HBAR-04, HBAR-05, HBAR-06
**Success Criteria** (what must be TRUE):
  1. Player can see a floating health bar above any hostile mob within 32 blocks
  2. Health bar floats ~0.5 blocks above the mob's head and always faces the player regardless of viewing angle
  3. Health bar shows current HP as a filled portion over an empty background, with the filled region shrinking as the mob takes damage
  4. Mobs with absorption display a third layer over the filled bar representing absorption amount
  5. Health bar is hidden when a mob is at full HP and has no active effects (clean visual when mobs are undamaged)
**Plans**: 1 plan

Plans:
- [ ] 83-01-PLAN.md — MobHealthBarRenderer with billboard positioning, three-layer texture rendering, and visibility gating

---

### Phase 84: Mob Effects Display

**Goal**: Active status effects on mobs are visible to the player as icons rendered above the health bar
**Depends on**: Phase 83 (needs billboard positioning and health bar as anchor)
**Requirements**: MEFF-01, MEFF-02, MEFF-03
**Success Criteria** (what must be TRUE):
  1. Player can see status effect icons arranged left-to-right directly above a mob's health bar
  2. Effect icons use the same frame/icon/overlay visual style as the player's effects GUI (consistent look)
  3. Effect duration overlays drain smoothly per tick, matching the effects GUI drain behavior
**Plans**: 1 plan

Plans:
- [ ] 84-01-PLAN.md — Extract shared effect rendering constants and add world-space effect icon rendering above mob health bars

---

### Phase 85: Scaling

**Goal**: Player can control the size of mob health bars and effect icons through Video Settings
**Depends on**: Phase 83, Phase 84 (both renderers must exist to be scaled)
**Requirements**: SCAL-01, SCAL-02
**Success Criteria** (what must be TRUE):
  1. A "Mob Health Bar" slider appears in Video Settings that controls the rendered size of health bars and effect icons
  2. Scaling preference persists across game restarts (saved to file)
**Plans**: 1 plan

Plans:
- [ ] 85-01-PLAN.md — MobHealthBarConfig with OptionInstance slider, Video Settings mixin extension, file persistence

---

## Coverage Validation

| Category | Requirements | Phase | Count |
|----------|--------------|-------|-------|
| HBAR | HBAR-01, HBAR-02, HBAR-03, HBAR-04, HBAR-05, HBAR-06 | 83 | 6 |
| MEFF | MEFF-01, MEFF-02, MEFF-03 | 84 | 3 |
| SCAL | SCAL-01, SCAL-02 | 85 | 2 |

**Total:** 11/11 requirements mapped (100% coverage)

---

## Milestone Summary

**Key Dependencies:**
- Phase 83 must complete first (health bar rendering establishes billboard positioning, world-space rendering infrastructure)
- Phase 84 depends on Phase 83 (effect icons anchor above the health bar)
- Phase 85 depends on both 83 and 84 (slider must scale both renderers)

**Reusable Patterns from v3.2 Effects GUI:**
- Layered frame rendering (effect_frame.png + icon + overlay)
- Sub-tick interpolation for smooth duration drain
- OptionInstance IntRange slider injection into Video Settings
- File-based scaling persistence
- Ratio-based proportional sizing

**Risk Areas:**
- World-space billboard rendering differs from screen-space HUD (new rendering context)
- Mob effect data must be synced from server to client (vanilla may not send all mob effects)
- Texture clipping for partial HP fill requires UV math in world-space

---

_Created: 2026-02-10 as part of v3.3 milestone roadmap_
