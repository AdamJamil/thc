---
phase: 01-land-plot-system
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [src/main/kotlin/thc/item/LandPlotItem.kt, src/main/kotlin/thc/item/THCItems.kt, src/main/kotlin/thc/THC.kt, src/main/java/thc/mixin/AbstractVillagerMixin.java, src/main/resources/assets/thc/lang/en_us.json, src/main/resources/assets/thc/models/item/land_plot.json, src/main/resources/assets/thc/textures/item/land_plot.png]
autonomous: true

must_haves:
  truths:
    - "Land plot book item exists in the game"
    - "Land plot book can be obtained (will be via bell in Plan 02)"
    - "Villagers no longer offer bells in trades"
  artifacts:
    - path: "src/main/kotlin/thc/item/LandPlotItem.kt"
      provides: "Land plot book item class"
      min_lines: 15
    - path: "src/main/kotlin/thc/item/THCItems.kt"
      provides: "Item registration"
      exports: ["LAND_PLOT"]
    - path: "src/main/java/thc/mixin/AbstractVillagerMixin.java"
      provides: "Bell trade removal"
      contains: "Items.BELL"
    - path: "src/main/resources/assets/thc/lang/en_us.json"
      provides: "Localized item name"
      contains: "land_plot"
  key_links:
    - from: "THC.kt onInitialize"
      to: "THCItems.init()"
      via: "registration call"
      pattern: "THCItems\\.init\\(\\)"
    - from: "AbstractVillagerMixin"
      to: "villager trades"
      via: "offer filtering"
      pattern: "removeIf.*Items\\.BELL"
---

<objective>
Create land plot book item and remove bells from villager trades.

Purpose: Establish the land plot economy - players must find bells in world, not buy from villagers. The land plot book is the currency for chunk claiming.
Output: Functional land plot book item with texture, and bells removed from all villager trading offers.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md

# Existing patterns from codebase
@src/main/kotlin/thc/item/BucklerItem.kt
@src/main/kotlin/thc/item/THCBucklers.kt
@src/main/kotlin/thc/THC.kt
@src/main/java/thc/mixin/AbstractVillagerMixin.java
@src/main/resources/fabric.mod.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create land plot book item with registration</name>
  <files>src/main/kotlin/thc/item/LandPlotItem.kt, src/main/kotlin/thc/item/THCItems.kt, src/main/kotlin/thc/THC.kt</files>
  <action>
1. Create `src/main/kotlin/thc/item/LandPlotItem.kt`:
   - Extend Item class (not BucklerItem - simpler item)
   - Use basic Item.Properties with stacksTo(1) (non-stackable, like written books)
   - No special use behavior yet (Plan 02 will handle chunk claiming)
   - Keep it simple - this is just the item definition

2. Create `src/main/kotlin/thc/item/THCItems.kt` (following THCBucklers.kt pattern):
   - Create companion object with @JvmField val LAND_PLOT
   - Register via Registry.register(Registries.ITEM, ...)
   - Use resource location "thc:land_plot"
   - Create init() function
   - Item.Properties should be: Item.Properties().stacksTo(1)

3. Update `src/main/kotlin/thc/THC.kt` onInitialize():
   - Add `THCItems.init()` call after THCAttachments.init() line
   - Follow existing pattern (THCBucklers.init(), THCSounds.init())

Follow Kotlin + Fabric 1.21.1 patterns. Base texture on vanilla book texture as discussed.
  </action>
  <verify>
gradle build completes successfully
No "unresolved reference" errors for THCItems or LandPlotItem
  </verify>
  <done>
Land plot item registered, THCItems.init() called during mod initialization, item can be spawned with /give
  </done>
</task>

<task type="auto">
  <name>Task 2: Remove bells from villager trades</name>
  <files>src/main/java/thc/mixin/AbstractVillagerMixin.java</files>
  <action>
Extend existing `AbstractVillagerMixin.thc$removeShieldTrades()` method to also filter bells:
- Current code: `offers.removeIf(offer -> offer.getResult().is(Items.SHIELD))`
- Add second filter: `offers.removeIf(offer -> offer.getResult().is(Items.BELL))`
- OR combine into single removeIf with || condition
- Use existing mixin injection point (@At("RETURN") on getOffers method)
- This ensures bells are removed from all villager professions (armorer, toolsmith, etc.)

Rationale: Bells must not be purchasable - players must explore to find naturally generated bells for land plots.
  </action>
  <verify>
gradle build completes successfully
Mixin applies without errors (check logs during test run)
  </verify>
  <done>
Bell trades removed from villagers, existing shield filtering still works
  </done>
</task>

<task type="auto">
  <name>Task 3: Add item assets (texture, model, localization)</name>
  <files>src/main/resources/assets/thc/textures/item/land_plot.png, src/main/resources/assets/thc/models/item/land_plot.json, src/main/resources/assets/thc/lang/en_us.json</files>
  <action>
1. Copy vanilla book texture as base for land_plot.png:
   - Location: src/main/resources/assets/thc/textures/item/land_plot.png
   - Use vanilla assets/minecraft/textures/item/book.png as reference
   - For now, just copy book texture directly (can be customized later)

2. Create item model JSON at src/main/resources/assets/thc/models/item/land_plot.json:
```json
{
  "parent": "minecraft:item/generated",
  "textures": {
    "layer0": "thc:item/land_plot"
  }
}
```

3. Add localization to src/main/resources/assets/thc/lang/en_us.json:
   - Add entry: "item.thc.land_plot": "Land Plot"
   - Maintain existing buckler entries
   - Follow JSON formatting (comma after previous entry)
  </action>
  <verify>
Item displays with texture in game when spawned via /give @p thc:land_plot
Item tooltip shows "Land Plot" name (not "item.thc.land_plot")
  </verify>
  <done>
Land plot item has visual representation and localized name
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] gradle build succeeds without errors
- [ ] /give @p thc:land_plot spawns the item in-game
- [ ] Land plot item displays with book texture
- [ ] Item name shows as "Land Plot"
- [ ] Item is non-stackable (stack size = 1)
- [ ] Villagers do not offer bells in trades
- [ ] Villagers still do not offer shields in trades (regression check)
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No build errors or warnings introduced
- Land plot item functional and visually correct
- Bell trade removal working
- Existing shield trade removal still working
</success_criteria>

<output>
After completion, create `.planning/phases/01-land-plot-system/01-01-SUMMARY.md`
</output>
