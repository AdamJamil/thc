---
phase: 04.1-bugfixes
verified: 2026-01-16T21:30:00Z
status: passed
score: 4/4 must-haves verified
---

# Phase 4.1: Bug Fixes Verification Report

**Phase Goal:** Fix bugs discovered during gameplay testing
**Verified:** 2026-01-16T21:30:00Z
**Status:** passed
**Re-verification:** No - initial verification

## Goal Achievement

### Observable Truths

| # | Truth | Status | Evidence |
|---|-------|--------|----------|
| 1 | Land plot item displays correct custom texture in inventory and hand | VERIFIED | Item definition at `items/land_plot.json` references model `thc:item/land_plot`, model exists at `models/item/land_plot.json` referencing texture `thc:item/land_plot`, texture file exists at `textures/item/land_plot.png` |
| 2 | Bells cannot be broken by players | VERIFIED | `BellProtection.kt` (30 lines) registers `PlayerBlockBreakEvents.BEFORE` handler that returns `false` when block is `Blocks.BELL`, registered in `THC.kt` line 43 before `BellHandler.register()` |
| 3 | Block placement rejection does not desync inventory | VERIFIED | `WorldRestrictions.kt` calls `player.containerMenu.sendAllDataToRemote()` on lines 114 and 122 before returning `InteractionResult.FAIL` for both non-allowlist blocks and adjacency violations |
| 4 | Blocks cannot be broken in village chunks (except ores and allowlist) | VERIFIED | `VillageProtection.kt` (74 lines) registers `PlayerBlockBreakEvents.BEFORE`, uses `ChunkValidator.isVillageChunk()` for detection, allows ores via `BlockTags` and allowlist blocks via `WorldRestrictions.ALLOWED_BLOCKS`, returns `false` otherwise. Registered in `THC.kt` line 47. `ChunkValidator.isVillageChunk()` (34 lines) uses hybrid detection: `chunk.allStarts` for structure origins + `getStructureWithPieceAt` for extensions |

**Score:** 4/4 truths verified

### Required Artifacts

| Artifact | Expected | Status | Details |
|----------|----------|--------|---------|
| `src/main/resources/assets/thc/items/land_plot.json` | MC 1.21+ item definition | VERIFIED | 6 lines, valid JSON, references `thc:item/land_plot` model |
| `src/main/resources/assets/thc/models/item/land_plot.json` | Item model | VERIFIED | 6 lines, references texture `thc:item/land_plot` |
| `src/main/resources/assets/thc/textures/item/land_plot.png` | Custom texture | VERIFIED | File exists |
| `src/main/kotlin/thc/bell/BellProtection.kt` | Bell break handler | VERIFIED | 30 lines, substantive, no stubs, returns false for bell blocks |
| `src/main/kotlin/thc/world/WorldRestrictions.kt` | Inventory sync fix | VERIFIED | 169 lines, `sendAllDataToRemote()` calls on lines 114 and 122 |
| `src/main/kotlin/thc/claim/ChunkValidator.kt` | Improved village detection | VERIFIED | 125 lines, `isVillageChunk()` uses hybrid approach: `chunk.allStarts` + `getStructureWithPieceAt` |
| `src/main/kotlin/thc/world/VillageProtection.kt` | Village block break protection | VERIFIED | 74 lines, checks village chunks, allows ores and allowlist, blocks other breaks |

### Key Link Verification

| From | To | Via | Status | Details |
|------|----|-----|--------|---------|
| `THC.kt` | `BellProtection.register()` | mod initialization | WIRED | Line 43: `BellProtection.register()` |
| `THC.kt` | `VillageProtection.register()` | mod initialization | WIRED | Line 47: `VillageProtection.register()` |
| `VillageProtection.kt` | `ChunkValidator.isVillageChunk()` | function call | WIRED | Line 36 checks `ChunkValidator.isVillageChunk(serverLevel, chunkPos)` |
| `VillageProtection.kt` | `WorldRestrictions.ALLOWED_BLOCKS` | set reference | WIRED | Line 46 checks `WorldRestrictions.ALLOWED_BLOCKS.contains(state.block)` |
| `items/land_plot.json` | `models/item/land_plot.json` | model reference | WIRED | `"model": "thc:item/land_plot"` |
| `models/item/land_plot.json` | `textures/item/land_plot.png` | texture reference | WIRED | `"layer0": "thc:item/land_plot"` |

### Anti-Patterns Found

| File | Line | Pattern | Severity | Impact |
|------|------|---------|----------|--------|
| - | - | - | - | No anti-patterns found |

**Scanned files:** BellProtection.kt, VillageProtection.kt, WorldRestrictions.kt, ChunkValidator.kt
**Patterns checked:** TODO, FIXME, placeholder, not implemented, return null, return {}, return []
**Result:** No stub patterns or incomplete implementations detected

### Human Verification Required

| # | Test | Expected | Why Human |
|---|------|----------|-----------|
| 1 | Place land plot item in hotbar and hold in hand | Item displays custom red/white texture (not purple/black missing texture) | Visual verification of texture rendering |
| 2 | Attempt to break a bell block | Bell does not break, no drops | Gameplay behavior verification |
| 3 | Outside base area, attempt to place non-allowlist block (e.g., stone) | Block not placed, item count does NOT flicker | Visual verification of inventory sync |
| 4 | In a village chunk, attempt to break a non-ore, non-allowlist block | Block does not break | Gameplay behavior in generated structures |

### Verification Summary

All four bugs have been addressed with substantive code implementations:

1. **Land plot texture (Truth 1):** Complete item definition chain: `items/land_plot.json` -> `models/item/land_plot.json` -> `textures/item/land_plot.png`. This follows the MC 1.21+ item model system requirements.

2. **Bell protection (Truth 2):** `BellProtection.kt` uses `PlayerBlockBreakEvents.BEFORE` to intercept all break attempts. Returns `false` for bells, blocking destruction. Registered early in initialization order.

3. **Inventory desync (Truth 3):** `WorldRestrictions.kt` now calls `sendAllDataToRemote()` before each `FAIL` return. This forces immediate client-server inventory sync, preventing visual flickering.

4. **Village block protection (Truth 4):** Two-part solution:
   - `VillageProtection.kt` registers block break handler that checks village chunks and enforces restrictions
   - `ChunkValidator.isVillageChunk()` uses hybrid detection (structure starts + piece sampling) for reliable village detection
   - Ore blocks allowed via `BlockTags` (coal, iron, copper, gold, redstone, lapis, diamond, emerald)
   - Allowlist blocks allowed via `WorldRestrictions.ALLOWED_BLOCKS`

All artifacts exist, are substantive (proper line counts, no stubs), and are properly wired into the mod initialization chain.

---

*Verified: 2026-01-16T21:30:00Z*
*Verifier: Claude (gsd-verifier)*
