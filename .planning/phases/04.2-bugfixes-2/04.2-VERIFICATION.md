---
phase: 04.2-bugfixes-2
verified: 2026-01-16T19:30:00Z
status: passed
score: 2/2 must-haves verified
---

# Phase 4.2: Bug Fixes 2 Verification Report

**Phase Goal:** Fix bell hardness (bedrock-like) and village chunk detection
**Verified:** 2026-01-16T19:30:00Z
**Status:** passed
**Re-verification:** No - initial verification

## Goal Achievement

### Observable Truths

| # | Truth | Status | Evidence |
|---|-------|--------|----------|
| 1 | Bells have bedrock-like hardness (mining never starts, 0 progress) | VERIFIED | BellBlockMixin.java injects into BlockBehaviour.getDestroyProgress and returns 0.0f for bells |
| 2 | Village chunks are reliably detected across all chunks the village spans | VERIFIED | ChunkValidator.isVillageChunk uses 63-point sampling (3x3 grid x 7 Y levels) with getStructureWithPieceAt |

**Score:** 2/2 truths verified

### Required Artifacts

| Artifact | Expected | Status | Details |
|----------|----------|--------|---------|
| `src/main/java/thc/mixin/BellBlockMixin.java` | Mixin that sets bell destroy time to extreme value | VERIFIED | 34 lines, targets BlockBehaviour.class, injects at getDestroyProgress HEAD, returns 0.0f for BELL blocks |
| `src/main/kotlin/thc/claim/ChunkValidator.kt` | Improved village detection using full-chunk structure reference scan | VERIFIED | 136 lines, isVillageChunk function implements dual detection: structure starts + multi-position piece sampling |

### Key Link Verification

| From | To | Via | Status | Details |
|------|-----|-----|--------|---------|
| thc.mixins.json | BellBlockMixin | mixin registration | WIRED | Line 7: "BellBlockMixin" included in mixins array |
| VillageProtection.kt | ChunkValidator.isVillageChunk | import + call | WIRED | Line 7 imports ChunkValidator, line 36 calls isVillageChunk |
| MiningFatigue.kt | ChunkValidator.isVillageChunk | import + call | WIRED | Imports ChunkValidator, line 88 calls isVillageChunk |
| LandPlotItem.kt | ChunkValidator.isVillageChunk | import + call | WIRED | Line 57 calls isVillageChunk for claim validation |
| THC.kt | BellProtection | should NOT be registered | VERIFIED | BellProtection NOT imported or called in THC.kt (mixin handles protection) |

### Artifact Analysis

#### BellBlockMixin.java (Level 1-3 Verification)

**Level 1 - Existence:** EXISTS (34 lines)

**Level 2 - Substantive:**
- Lines: 34 (above 15-line minimum for mixin)
- No TODO/FIXME/placeholder patterns
- Real implementation: `@Inject` annotation, proper method signature, `cir.setReturnValue(0.0f)`
- Targets `BlockBehaviour.class` (correct - getDestroyProgress is inherited from BlockBehaviour, not overridden by BellBlock)
- Checks `state.is(Blocks.BELL)` before returning 0

**Level 3 - Wired:**
- Registered in thc.mixins.json at line 7
- Uses proper mixin prefix `thc$` for method name

#### ChunkValidator.kt (Level 1-3 Verification)

**Level 1 - Existence:** EXISTS (136 lines)

**Level 2 - Substantive:**
- Lines: 136 (well above minimum)
- No TODO/FIXME/placeholder patterns
- isVillageChunk function (lines 76-117) implements:
  - Method 1: Check chunk.allStarts for village structure starts (lines 81-95)
  - Method 2: Multi-position sampling with getStructureWithPieceAt (lines 97-114)
  - 63 total checks: 9 positions (3x3 grid at x=2,8,14 and z=2,8,14) x 7 Y levels (55,60,63,64,70,75,80)

**Level 3 - Wired:**
- Called by VillageProtection.kt line 36
- Called by MiningFatigue.kt line 88
- Called by LandPlotItem.kt line 57

### Anti-Patterns Found

| File | Line | Pattern | Severity | Impact |
|------|------|---------|----------|--------|
| None found | - | - | - | - |

### Redundant Code Note

BellProtection.kt still exists at `src/main/kotlin/thc/bell/BellProtection.kt` but is NOT registered in THC.kt. This is harmless dead code - the mixin approach supersedes the event-based approach. The file can be deleted in a future cleanup pass but does not affect functionality.

### Human Verification Required

#### 1. Bell Bedrock-like Behavior
**Test:** In-game, attempt to mine a bell with any tool
**Expected:** No mining animation starts, no progress bar appears, bell cannot be broken (like bedrock)
**Why human:** Visual mining animation behavior cannot be verified programmatically

#### 2. Village Chunk Detection Across Boundaries
**Test:** Find a village that spans multiple chunks. Stand in a chunk that contains village buildings but not the village center. Attempt to break a non-ore, non-allowlist block.
**Expected:** Block break is denied (cannot break non-protected blocks in village chunks)
**Why human:** Need to verify actual structure piece detection works at village boundaries

---

*Verified: 2026-01-16T19:30:00Z*
*Verifier: Claude (gsd-verifier)*
