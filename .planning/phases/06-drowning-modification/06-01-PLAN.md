---
phase: 06-drowning-modification
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/main/java/thc/mixin/LivingEntityDrowningMixin.java
  - src/main/resources/thc.mixins.json
autonomous: true

must_haves:
  truths:
    - "Once drowning begins, damage ticks occur every 4 seconds instead of every 1 second"
  artifacts:
    - path: "src/main/java/thc/mixin/LivingEntityDrowningMixin.java"
      provides: "Drowning damage tick rate modification"
      min_lines: 20
  key_links:
    - from: "LivingEntityDrowningMixin.java"
      to: "thc.mixins.json"
      via: "mixin registration"
      pattern: "LivingEntityDrowningMixin"
---

<objective>
Slow drowning damage tick rate to 4x less frequent (every 4 seconds instead of every 1 second).

Purpose: Makes underwater exploration more forgiving, supporting the risk/reward philosophy by reducing tedium while maintaining underwater as dangerous over time.

Output: Mixin that intercepts drowning damage application and reduces frequency.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/research/SUMMARY.md

# Existing patterns:
@src/main/java/thc/mixin/LivingEntityMixin.java
@src/main/resources/thc.mixins.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create LivingEntityDrowningMixin</name>
  <files>src/main/java/thc/mixin/LivingEntityDrowningMixin.java</files>
  <action>
Create a new mixin targeting LivingEntity to slow drowning damage.

**Vanilla drowning mechanics (from research):**
- Air supply: 300 ticks (15 seconds), decreases 1/tick underwater
- When air reaches -20, entity takes 2 damage (1 heart) and air resets to 0
- This creates 1 damage tick per second cycle

**Implementation approach:**
Intercept the drowning damage application in `baseTick()`. The method calls `hurt()` with `DamageTypes.DROWN` when air is -20. Use @Inject at HEAD of the hurt method or intercept the drowning logic directly.

**Preferred approach - modify drowning damage check:**
Use @Redirect or @Inject on `baseTick()` to change when drowning damage is applied. Instead of every 20 ticks (air going from 0 to -20), only apply every 80 ticks.

**Alternative approach - counter-based:**
Track a counter for each entity. Only let drowning damage through every 4th time it would normally occur.

**Implementation:**
```java
@Mixin(LivingEntity.class)
public abstract class LivingEntityDrowningMixin {
    // Track drowning damage skip counter (reset when entity surfaces)
    @Unique
    private int thc$drowningDamageCounter = 0;

    // Inject before drowning damage is applied in baseTick
    // When air reaches -20, vanilla calls hurt(DROWN, 2.0F)
    // We intercept and only allow every 4th damage tick
}
```

Use @Inject at the point where drowning damage is dealt. Check if `air == -20` condition is met, then use counter logic to skip 3 out of 4 damage applications.

**Key method to target:** Look for where `this.hurt(this.damageSources().drown(), 2.0F)` is called in LivingEntity.baseTick() or related method.

**Note:** Keep separate from existing LivingEntityMixin (buckler combat) to maintain clean separation of concerns.
  </action>
  <verify>
./gradlew build succeeds without errors
Mixin compiles and applies correctly
  </verify>
  <done>
LivingEntityDrowningMixin.java created with drowning damage frequency reduction logic
  </done>
</task>

<task type="auto">
  <name>Task 2: Register mixin and verify</name>
  <files>src/main/resources/thc.mixins.json</files>
  <action>
Add "LivingEntityDrowningMixin" to the mixins array in thc.mixins.json.

After registration, run `./gradlew build` to verify compilation.

**Testing approach:**
Manual testing in-game is the most reliable verification:
1. Start game, enter creative mode
2. Build underwater chamber
3. Switch to survival, let air deplete
4. Once drowning starts, time the damage ticks
5. Should be every ~4 seconds instead of every ~1 second

Alternatively, if game tests are feasible for this mechanic, consider adding one in a future iteration.
  </action>
  <verify>
./gradlew build succeeds
thc.mixins.json contains "LivingEntityDrowningMixin" entry
  </verify>
  <done>
Mixin registered and build passes
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `./gradlew build` succeeds without errors
- [ ] LivingEntityDrowningMixin.java exists with proper mixin annotations
- [ ] thc.mixins.json includes LivingEntityDrowningMixin
- [ ] No TypeScript/Kotlin compilation errors
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Drowning damage modification mixin compiles and is registered
- Build produces working mod JAR
</success_criteria>

<output>
After completion, create `.planning/phases/06-drowning-modification/06-01-SUMMARY.md`
</output>
