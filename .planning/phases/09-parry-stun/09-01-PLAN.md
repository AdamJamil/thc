---
phase: 09-parry-stun
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [src/main/java/thc/mixin/LivingEntityMixin.java]
autonomous: true

must_haves:
  truths:
    - "Successful buckler parry stuns all enemies within 3 blocks of player"
    - "Stunned enemies receive ~1 block knockback away from the parrying player"
  artifacts:
    - path: "src/main/java/thc/mixin/LivingEntityMixin.java"
      provides: "Parry stun range and knockback implementation"
      contains: "inflate(3.0D)"
  key_links:
    - from: "thc$stunNearby"
      to: "getBoundingBox().inflate()"
      via: "range parameter"
      pattern: "inflate\\(3\\.0D\\)"
    - from: "thc$stunNearby"
      to: "mob.setDeltaMovement"
      via: "knockback calculation"
      pattern: "setDeltaMovement"
---

<objective>
Enhance buckler parry crowd control with increased stun range and knockback.

Purpose: Make successful parries more impactful for crowd control, rewarding skillful timing with better defensive utility against groups.
Output: Modified `thc$stunNearby` method with 3-block range and knockback application.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@src/main/java/thc/mixin/LivingEntityMixin.java
</context>

<tasks>

<task type="auto">
  <name>Task 1: Increase parry stun range to 3 blocks</name>
  <files>src/main/java/thc/mixin/LivingEntityMixin.java</files>
  <action>
In the `thc$stunNearby` method, change the bounding box inflation from 2.0D to 3.0D:
- Current: `player.getBoundingBox().inflate(2.0D)`
- Change to: `player.getBoundingBox().inflate(3.0D)`

This extends the stun AoE from 2 blocks to 3 blocks radius around the parrying player.
  </action>
  <verify>Grep for `inflate(3.0D)` in LivingEntityMixin.java returns a match</verify>
  <done>Stun range increased from 2 blocks to 3 blocks</done>
</task>

<task type="auto">
  <name>Task 2: Add knockback to stunned enemies</name>
  <files>src/main/java/thc/mixin/LivingEntityMixin.java</files>
  <action>
In the `thc$stunNearby` method, after applying effects to each mob, calculate and apply knockback:

1. Calculate direction vector from player to mob: `Vec3 direction = mob.position().subtract(player.position()).normalize()`
2. Apply ~1 block knockback using `mob.setDeltaMovement(direction.x * 0.5, 0.2, direction.z * 0.5)`
   - 0.5 horizontal component gives approximately 1 block of push
   - 0.2 vertical component gives slight upward lift to ensure knockback triggers
3. Call `mob.hasImpulse = true` to ensure the velocity change is processed

Place the knockback logic inside the for loop, after the `mob.addEffect(weak, player)` line.

Note: The horizontal knockback of 0.5 units with a small vertical component (0.2) creates approximately 1 block of effective knockback distance. This is similar to vanilla knockback calculations.
  </action>
  <verify>Grep for `setDeltaMovement` in LivingEntityMixin.java returns a match</verify>
  <done>Stunned enemies receive ~1 block knockback away from the parrying player</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `./gradlew build` succeeds without errors
- [ ] LivingEntityMixin.java contains `inflate(3.0D)` in thc$stunNearby
- [ ] LivingEntityMixin.java contains `setDeltaMovement` for knockback in thc$stunNearby
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No errors or warnings introduced
- PARRY-01: Stun range extended to 3 blocks
- PARRY-02: Knockback applied to stunned enemies
  </success_criteria>

<output>
After completion, create `.planning/phases/09-parry-stun/09-01-SUMMARY.md`
</output>
