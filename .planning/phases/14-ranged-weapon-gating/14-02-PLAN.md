---
phase: 14-ranged-weapon-gating
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/main/kotlin/thc/THC.kt
autonomous: true

must_haves:
  truths:
    - "Bows do not appear in any chest loot tables"
    - "Crossbows do not appear in any chest loot tables"
    - "Bows do not drop from any mob (skeleton, stray, etc.)"
    - "Crossbows do not drop from any mob (pillager, piglin)"
  artifacts:
    - path: "src/main/kotlin/thc/THC.kt"
      provides: "Extended removedItems set with bow and crossbow"
      contains: "Items.BOW"
  key_links:
    - from: "THC.kt removedItems"
      to: "LootTableEvents.MODIFY_DROPS"
      via: "drops.removeIf filter"
      pattern: "removedItems.any"
---

<objective>
Remove bows and crossbows from all loot sources (chest loot tables and mob drops).

Purpose: Ensure players can only obtain bows/crossbows through crafting with Trial Chamber materials.
Output: Extended removedItems set that filters bows and crossbows from all loot drops.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

Relevant source files:
@src/main/kotlin/thc/THC.kt â€” existing removedItems set and LootTableEvents.MODIFY_DROPS handler
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add bow and crossbow to removedItems set</name>
  <files>src/main/kotlin/thc/THC.kt</files>
  <action>
Extend the existing removedItems set to include Items.BOW and Items.CROSSBOW.

Current removedItems set (around line 65-74):
```kotlin
val removedItems = setOf(
    Items.SHIELD,
    Items.WOODEN_SPEAR,
    Items.STONE_SPEAR,
    Items.COPPER_SPEAR,
    Items.IRON_SPEAR,
    Items.GOLDEN_SPEAR,
    Items.DIAMOND_SPEAR,
    Items.NETHERITE_SPEAR
)
```

Add Items.BOW and Items.CROSSBOW to this set:
```kotlin
val removedItems = setOf(
    Items.SHIELD,
    Items.WOODEN_SPEAR,
    Items.STONE_SPEAR,
    Items.COPPER_SPEAR,
    Items.IRON_SPEAR,
    Items.GOLDEN_SPEAR,
    Items.DIAMOND_SPEAR,
    Items.NETHERITE_SPEAR,
    Items.BOW,
    Items.CROSSBOW
)
```

The existing LootTableEvents.MODIFY_DROPS handler already filters all items in removedItems from every loot drop (chest loot tables, mob drops, etc.), so no additional code changes are needed.

This single change blocks all acquisition paths:
- Skeleton drops (bow)
- Stray drops (bow)
- Pillager drops (crossbow)
- Piglin barter (crossbow)
- All chest loot tables (villages, dungeons, bastion remnants, etc.)
  </action>
  <verify>
grep -A 15 "removedItems = setOf" src/main/kotlin/thc/THC.kt | grep -q "Items.BOW" && echo "OK: BOW found"
grep -A 15 "removedItems = setOf" src/main/kotlin/thc/THC.kt | grep -q "Items.CROSSBOW" && echo "OK: CROSSBOW found"
./gradlew build 2>&1 | tail -5
  </verify>
  <done>BOW and CROSSBOW added to removedItems set, build passes</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Items.BOW is in removedItems set
- [ ] Items.CROSSBOW is in removedItems set
- [ ] `./gradlew build` succeeds without errors
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No errors or warnings introduced
- Bow and crossbow will be filtered from all loot drops
  </success_criteria>

<output>
After completion, create `.planning/phases/14-ranged-weapon-gating/14-02-SUMMARY.md`
</output>
