---
phase: 16-world-difficulty
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/main/kotlin/thc/THC.kt
  - src/main/resources/data/minecraft/loot_table/blocks/smooth_stone.json
autonomous: true
must_haves:
  truths:
    - "Creepers do not destroy blocks when exploding"
    - "Endermen cannot pick up blocks"
    - "Smooth stone drops cobblestone when mined without silk touch"
    - "Smooth stone drops smooth stone when mined with silk touch"
  artifacts:
    - path: "src/main/kotlin/thc/THC.kt"
      provides: "doMobGriefing gamerule set to false"
      contains: "DO_MOB_GRIEFING"
    - path: "src/main/resources/data/minecraft/loot_table/blocks/smooth_stone.json"
      provides: "Silk touch conditional loot table"
      contains: "silk_touch"
  key_links:
    - from: "THC.kt onInitialize"
      to: "GameRules.DO_MOB_GRIEFING"
      via: "world.gameRules.set at server start"
      pattern: "DO_MOB_GRIEFING.*false"
---

<objective>
Disable mob griefing world-wide and fix smooth stone loot table with silk touch support.

Purpose: Prevent environmental destruction from mobs (creepers, endermen) while ensuring smooth stone requires silk touch to keep (otherwise drops cobblestone).
Output: Modified THC.kt with mob griefing gamerule, fixed smooth stone loot table with silk touch condition.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Existing patterns for GameRules modification:
@src/main/kotlin/thc/THC.kt

# Current smooth stone loot table (needs silk touch condition):
@src/main/resources/data/minecraft/loot_table/blocks/smooth_stone.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Disable mob griefing gamerule at server start</name>
  <files>src/main/kotlin/thc/THC.kt</files>
  <action>
    In the SERVER_STARTED event handler (inside the world.forEach loop), add a call to disable mob griefing:

    `world.gameRules.set(GameRules.DO_MOB_GRIEFING, false, server)`

    Place this alongside the existing `world.gameRules.set(GameRules.ADVANCE_TIME, false, server)` call in the lockWorldToNight function or in the same loop. The GameRules.DO_MOB_GRIEFING constant already exists in net.minecraft.world.level.gamerules.GameRules.

    This disables:
    - Creeper explosions destroying blocks
    - Endermen picking up blocks
    - Ghast fireballs destroying blocks
    - Other mob griefing behaviors
  </action>
  <verify>Build succeeds with `./gradlew build`</verify>
  <done>Mob griefing gamerule is set to false for all worlds on server start</done>
</task>

<task type="auto">
  <name>Task 2: Fix smooth stone loot table with silk touch condition</name>
  <files>src/main/resources/data/minecraft/loot_table/blocks/smooth_stone.json</files>
  <action>
    Replace the current loot table (which always drops cobblestone) with one that:
    - Drops smooth_stone if mined with silk touch
    - Drops cobblestone otherwise

    Use the vanilla loot table format with match_tool condition and minecraft:silk_touch enchantment check.

    Structure:
    ```json
    {
      "type": "minecraft:block",
      "pools": [
        {
          "rolls": 1,
          "entries": [
            {
              "type": "minecraft:alternatives",
              "children": [
                {
                  "type": "minecraft:item",
                  "name": "minecraft:smooth_stone",
                  "conditions": [
                    {
                      "condition": "minecraft:match_tool",
                      "predicate": {
                        "enchantments": [
                          {
                            "enchantment": "minecraft:silk_touch",
                            "levels": { "min": 1 }
                          }
                        ]
                      }
                    }
                  ]
                },
                {
                  "type": "minecraft:item",
                  "name": "minecraft:cobblestone"
                }
              ]
            }
          ],
          "conditions": [
            {
              "condition": "minecraft:survives_explosion"
            }
          ]
        }
      ]
    }
    ```

    The "alternatives" entry type tries children in order, using the first one whose conditions pass.
  </action>
  <verify>JSON is valid and `./gradlew build` succeeds</verify>
  <done>Smooth stone drops smooth_stone with silk touch, cobblestone otherwise</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `./gradlew build` succeeds without errors
- [ ] GameRules.DO_MOB_GRIEFING is set to false in server start handler
- [ ] Smooth stone loot table has silk_touch conditional logic
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No errors or warnings introduced
- WORLD-01 (mob griefing disabled) implemented
- WORLD-02 (smooth stone with silk touch) implemented
</success_criteria>

<output>
After completion, create `.planning/phases/16-world-difficulty/16-01-SUMMARY.md`
</output>
