---
phase: 18-twilight-visuals
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/client/java/thc/mixin/client/ClientLevelTimeMixin.java
  - src/client/resources/thc.client.mixins.json
autonomous: true
must_haves:
  truths:
    - "Player sees dusk sky at all server times"
    - "Dusk visual appears at ~13000 ticks equivalent"
    - "Nether dimension shows normal Nether sky"
    - "End dimension shows normal End sky"
  artifacts:
    - path: "src/client/java/thc/mixin/client/ClientLevelTimeMixin.java"
      provides: "Client-side time override for sky rendering"
      min_lines: 15
      contains: "getTimeOfDay"
    - path: "src/client/resources/thc.client.mixins.json"
      provides: "Mixin registration"
      contains: "ClientLevelTimeMixin"
  key_links:
    - from: "ClientLevelTimeMixin"
      to: "ClientLevel.getTimeOfDay"
      via: "@Inject RETURN modification"
      pattern: "getTimeOfDay"
---

<objective>
Override client-side time rendering to show perpetual dusk sky regardless of server time.

Purpose: Create the visual atmosphere of eternal twilight where the sky always appears at dusk (~13000 ticks) while server time flows normally.
Output: Client mixin that returns fixed dusk time for sky rendering, Overworld only.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior phase context
@.planning/phases/17-remove-night-lock/17-01-SUMMARY.md

# Existing client mixin infrastructure
@src/client/resources/thc.client.mixins.json
@src/client/java/thc/mixin/client/ExampleClientMixin.java

# Reference for mixin patterns
@src/main/java/thc/mixin/ServerLevelDifficultyMixin.java
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ClientLevelTimeMixin for dusk sky</name>
  <files>src/client/java/thc/mixin/client/ClientLevelTimeMixin.java</files>
  <action>
Create a client mixin targeting `net.minecraft.client.multiplayer.ClientLevel` that overrides `getTimeOfDay(float)` to return a fixed dusk time.

Implementation:
1. Mixin class: `ClientLevelTimeMixin`
2. Target: `ClientLevel`
3. Method: `getTimeOfDay(float)` - returns float for sky rendering
4. Use `@Inject` at `RETURN` with `cancellable = true` to replace return value
5. Fixed dusk time: Return `0.7916667F` (equivalent to 13000/24000 ticks normalized)
6. Dimension check: Only modify for Overworld dimension
   - Cast `(ClientLevel)(Object)this` to get self
   - Check `self.dimension() == Level.OVERWORLD` before modifying
   - If Nether/End, let vanilla return value pass through

The method `getTimeOfDay(float partialTick)` returns a float from 0.0 to 1.0 representing the day cycle:
- 0.0 = 0 ticks (sunrise)
- 0.25 = 6000 ticks (noon)
- 0.5 = 12000 ticks (sunset)
- 0.541667 = 13000 ticks (dusk - target)
- 0.75 = 18000 ticks (midnight)

Use naming convention: `thc$forceDuskTime` for the inject method.
  </action>
  <verify>Build succeeds: `./gradlew build`</verify>
  <done>ClientLevelTimeMixin exists, targets getTimeOfDay, returns fixed dusk value for Overworld only</done>
</task>

<task type="auto">
  <name>Task 2: Register mixin in client config</name>
  <files>src/client/resources/thc.client.mixins.json</files>
  <action>
Add `ClientLevelTimeMixin` to the client mixin list in thc.client.mixins.json.

The file already has a `client` array with `ExampleClientMixin`. Add `ClientLevelTimeMixin` to this array.
  </action>
  <verify>JSON is valid, build succeeds</verify>
  <done>ClientLevelTimeMixin registered in client mixin config</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `./gradlew build` succeeds without errors
- [ ] ClientLevelTimeMixin.java exists with getTimeOfDay inject
- [ ] thc.client.mixins.json includes ClientLevelTimeMixin
- [ ] Mixin has Overworld dimension check
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Build compiles without mixin errors
- Mixin properly checks dimension before applying time override
</success_criteria>

<output>
After completion, create `.planning/phases/18-twilight-visuals/18-01-SUMMARY.md`
</output>
