---
phase: 24-blast-totem
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/main/kotlin/thc/item/THCItems.kt
  - src/main/kotlin/thc/THC.kt
  - src/main/resources/assets/thc/items/blast_totem.json
  - src/main/resources/assets/thc/models/item/blast_totem.json
  - src/main/resources/assets/thc/lang/en_us.json
autonomous: true

must_haves:
  truths:
    - "Player can obtain Blast Totem from Evoker drops"
    - "Blast Totem displays custom texture in inventory"
    - "Totem of Undying no longer drops from any source"
  artifacts:
    - path: "src/main/kotlin/thc/item/THCItems.kt"
      provides: "BLAST_TOTEM item registration"
      contains: "BLAST_TOTEM"
    - path: "src/main/resources/assets/thc/items/blast_totem.json"
      provides: "Item definition JSON"
    - path: "src/main/resources/assets/thc/models/item/blast_totem.json"
      provides: "Item model referencing texture"
      contains: "thc:item/blast_totem"
  key_links:
    - from: "THCItems.kt"
      to: "Registry"
      via: "Registry.register in register function"
      pattern: "BLAST_TOTEM.*register"
    - from: "THC.kt"
      to: "LootTableEvents"
      via: "MODIFY_DROPS replacing totem_of_undying with blast_totem"
      pattern: "TOTEM_OF_UNDYING"
---

<objective>
Register Blast Totem as custom item and replace all Totem of Undying drops with Blast Totem.

Purpose: Progression gating - Blast Totem will be required for blast furnace crafting (Phase 25), making Nether access a prerequisite for smelting.
Output: Working Blast Totem item that drops from Evokers instead of Totem of Undying.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Established patterns (from prior phases)
@src/main/kotlin/thc/item/THCItems.kt
@src/main/kotlin/thc/THC.kt
@src/main/resources/assets/thc/items/land_plot.json
@src/main/resources/assets/thc/models/item/land_plot.json
@src/main/resources/assets/thc/lang/en_us.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Register Blast Totem item</name>
  <files>src/main/kotlin/thc/item/THCItems.kt, src/main/resources/assets/thc/items/blast_totem.json, src/main/resources/assets/thc/models/item/blast_totem.json, src/main/resources/assets/thc/lang/en_us.json</files>
  <action>
    1. In THCItems.kt, add BLAST_TOTEM item registration following LAND_PLOT pattern:
       - Use default Item.Properties with stacksTo(1) for single-stack like totem
       - Item key: "blast_totem"
       - Add to init() for creative tab registration (tools tab like LAND_PLOT)

    2. Create items/blast_totem.json following land_plot.json pattern:
       ```json
       {
         "model": {
           "type": "minecraft:model",
           "model": "thc:item/blast_totem"
         }
       }
       ```

    3. Create models/item/blast_totem.json following land_plot.json pattern:
       ```json
       {
         "parent": "minecraft:item/generated",
         "textures": {
           "layer0": "thc:item/blast_totem"
         }
       }
       ```
       Texture blast_totem.png already exists at textures/item/

    4. Add to lang/en_us.json:
       "item.thc.blast_totem": "Blast Totem"
  </action>
  <verify>./gradlew build --quiet succeeds with no errors</verify>
  <done>BLAST_TOTEM item registered, appears in creative menu with correct texture and name</done>
</task>

<task type="auto">
  <name>Task 2: Replace Totem of Undying drops with Blast Totem</name>
  <files>src/main/kotlin/thc/THC.kt</files>
  <action>
    Modify the existing LootTableEvents.MODIFY_DROPS handler in THC.kt:

    1. Add Items.TOTEM_OF_UNDYING to removedItems set (alongside existing shield/spear/bow/crossbow entries)

    2. Extend the MODIFY_DROPS callback to replace totem drops with blast totem:
       - After the removeIf call, add logic to detect if a totem was removed
       - If totem was in original drops (can track this before removeIf), add THCItems.BLAST_TOTEM.defaultInstance to drops

       Pattern:
       ```kotlin
       LootTableEvents.MODIFY_DROPS.register { _, _, drops ->
           val hadTotem = drops.any { it.`is`(Items.TOTEM_OF_UNDYING) }
           drops.removeIf { stack -> removedItems.any { stack.`is`(it) } }
           if (hadTotem) {
               drops.add(THCItems.BLAST_TOTEM.defaultInstance)
           }
       }
       ```

    Why: Evokers drop Totem of Undying via their loot table. MODIFY_DROPS intercepts all loot generation. By removing totem and adding blast totem in the same handler, all sources (Evoker, chest loot, commands) get converted.
  </action>
  <verify>./gradlew build --quiet succeeds</verify>
  <done>Totem of Undying no longer drops, Blast Totem drops in its place from all sources</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `./gradlew build` succeeds without errors
- [ ] BLAST_TOTEM is registered in THCItems with @JvmField
- [ ] Item JSON files exist and reference correct model/texture paths
- [ ] Language key added for "Blast Totem" display name
- [ ] Items.TOTEM_OF_UNDYING in removedItems set
- [ ] Replacement logic adds BLAST_TOTEM when totem was present in drops
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Build compiles without errors
- Blast Totem item fully registered with texture and localization
- Totem of Undying replaced by Blast Totem in all loot drops
</success_criteria>

<output>
After completion, create `.planning/phases/24-blast-totem/24-01-SUMMARY.md`
</output>
