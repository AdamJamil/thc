---
phase: 29-saturation-tiers
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [src/main/java/thc/mixin/FoodDataMixin.java]
autonomous: true

must_haves:
  truths:
    - "Player with saturation 6.36+ heals at base + 1 heart/s"
    - "Player with saturation 2.73-6.35 heals at base + 0.5 heart/s"
    - "Player with saturation 1.36-2.72 heals at base + 3/16 heart/s"
    - "Player with saturation 0.45-1.35 heals at base + 1/8 heart/s"
    - "Player with saturation 0-0.44 heals at base + 1/16 heart/s"
    - "All tiers still require hunger >= 18 to heal"
  artifacts:
    - path: "src/main/java/thc/mixin/FoodDataMixin.java"
      provides: "Tiered healing rate calculation"
      contains: "getSaturationLevel()"
  key_links:
    - from: "FoodDataMixin.tick()"
      to: "saturation level"
      via: "getSaturationLevel() to tier mapping"
      pattern: "getSaturationLevel.*>=.*6\\.36"
---

<objective>
Add saturation-tiered healing rate bonuses to the existing FoodDataMixin tick() override.

Purpose: Enable skilled food management to provide meaningful healing bonuses - high saturation rewards faster recovery.
Output: Modified FoodDataMixin with tiered healing calculation based on saturation thresholds.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/28-exhaustion-healing/28-01-SUMMARY.md

# Source file to modify:
@src/main/java/thc/mixin/FoodDataMixin.java
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement saturation tier healing calculation</name>
  <files>src/main/java/thc/mixin/FoodDataMixin.java</files>
  <action>
Modify the healing section of thc$overrideTick() to calculate tier-based healing rates:

**Tier thresholds and bonus rates:**
- T5: saturation >= 6.36 → +1 heart/s (20 ticks/HP)
- T4: saturation >= 2.73 → +0.5 heart/s (40 ticks/HP)
- T3: saturation >= 1.36 → +3/16 heart/s (~53 ticks/HP, same as base)
- T2: saturation >= 0.45 → +1/8 heart/s (80 ticks/HP)
- T1: saturation < 0.45 → +1/16 heart/s (160 ticks/HP)

**Implementation approach:**
1. Get current saturation via getSaturationLevel()
2. Determine tier based on thresholds (check highest first)
3. Calculate tick interval for that tier (20/40/53/80/160)
4. Use tier interval in the existing timer check

**Code structure:**
```java
// CUSTOM HEALING with saturation tiers
if (this.foodLevel >= 18 && player.isHurt()) {
    float saturation = this.getSaturationLevel();

    // Determine heal interval based on saturation tier
    // T5: 6.36+ = +1 heart/s (20 ticks)
    // T4: 2.73+ = +0.5 heart/s (40 ticks)
    // T3: 1.36+ = +3/16 heart/s (53 ticks)
    // T2: 0.45+ = +1/8 heart/s (80 ticks)
    // T1: 0-0.44 = +1/16 heart/s (160 ticks)
    int healInterval;
    if (saturation >= 6.36F) {
        healInterval = 20;
    } else if (saturation >= 2.73F) {
        healInterval = 40;
    } else if (saturation >= 1.36F) {
        healInterval = 53;
    } else if (saturation >= 0.45F) {
        healInterval = 80;
    } else {
        healInterval = 160;
    }

    int timer = accessor.getTickTimer();
    accessor.setTickTimer(timer + 1);
    if (timer >= healInterval) {
        player.heal(1.0F);
        this.addExhaustion(6.0F);
        accessor.setTickTimer(0);
    }
}
```

**Important:** The base rate (3/16 hearts/s = 53 ticks) becomes T3, not the floor. Lower saturation gives SLOWER healing.

Update the class javadoc to document the tier system.
  </action>
  <verify>./gradlew build succeeds with no mixin injection errors</verify>
  <done>FoodDataMixin calculates heal interval based on saturation tier thresholds</done>
</task>

<task type="auto">
  <name>Task 2: Verify tier boundaries in-game</name>
  <files>N/A (verification only)</files>
  <action>
Run the game client and verify tier boundaries work correctly:

1. Start game, enable F3 debug overlay to see saturation level
2. Give player damage: /damage @s 10 minecraft:generic
3. Eat golden carrot (high saturation) - should heal fast (T5)
4. Wait for saturation to drain below 2.73 - healing should slow to T4
5. Continue watching as saturation drops through T3, T2, T1
6. At low saturation (<0.45), healing should be very slow (160 tick interval)

**Test commands:**
```
/effect give @s minecraft:saturation 1 5 true  # Boost saturation
/effect clear @s minecraft:saturation
```

Watch F3 saturation value and correlate with healing speed.
  </action>
  <verify>Visual confirmation that healing rate changes at tier thresholds</verify>
  <done>Healing rate visibly changes as saturation drains through tiers</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `./gradlew build` succeeds without errors
- [ ] No mixin injection warnings in build output
- [ ] Saturation tier thresholds match requirements (6.36, 2.73, 1.36, 0.45)
- [ ] Healing interval changes observed at each tier boundary
</verification>

<success_criteria>

- All tasks completed
- Saturation T5 (6.36+) heals at 20 ticks/HP (+1 heart/s)
- Saturation T4 (2.73+) heals at 40 ticks/HP (+0.5 heart/s)
- Saturation T3 (1.36+) heals at 53 ticks/HP (+3/16 heart/s)
- Saturation T2 (0.45+) heals at 80 ticks/HP (+1/8 heart/s)
- Saturation T1 (0-0.44) heals at 160 ticks/HP (+1/16 heart/s)
- Hunger >= 18 still required for any healing
  </success_criteria>

<output>
After completion, create `.planning/phases/29-saturation-tiers/29-01-SUMMARY.md`
</output>
