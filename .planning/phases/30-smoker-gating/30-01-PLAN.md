---
phase: 30-smoker-gating
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/main/java/thc/mixin/RecipeManagerMixin.java
  - src/main/java/thc/mixin/StructureTemplateMixin.java
  - src/main/resources/data/minecraft/recipe/smoker.json
autonomous: true

must_haves:
  truths:
    - "Vanilla smoker recipe is uncraftable"
    - "Custom smoker recipe requires 2 iron ingots in top corners"
    - "Smokers do not spawn in newly generated villages"
    - "Existing smoker block functionality is unchanged"
  artifacts:
    - path: "src/main/resources/data/minecraft/recipe/smoker.json"
      provides: "Custom smoker recipe with iron requirement"
      contains: "iron_ingot"
    - path: "src/main/java/thc/mixin/RecipeManagerMixin.java"
      provides: "Recipe filtering including smoker"
      contains: "smoker"
    - path: "src/main/java/thc/mixin/StructureTemplateMixin.java"
      provides: "Structure block filtering including smoker"
      contains: "SMOKER"
  key_links:
    - from: "RecipeManagerMixin.java"
      to: "REMOVED_RECIPE_PATHS"
      via: "smoker string in set"
      pattern: '"smoker"'
    - from: "StructureTemplateMixin.java"
      to: "FILTERED_STRUCTURE_BLOCKS"
      via: "Blocks.SMOKER in set"
      pattern: "Blocks\\.SMOKER"
---

<objective>
Gate smoker behind iron acquisition, preventing early-game food cooking.

Purpose: Smokers allow fast food cooking. Gating behind iron creates meaningful progression where players must risk cave exploration before accessing efficient cooking. Follows furnace gating pattern from Phase 25.
Output: Modified recipe filter, structure filter, and custom recipe JSON.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

Prior phase pattern:
@.planning/phases/25-furnace-gating/25-01-SUMMARY.md
@.planning/phases/25-furnace-gating/25-02-SUMMARY.md

Source files to modify:
@src/main/java/thc/mixin/RecipeManagerMixin.java
@src/main/java/thc/mixin/StructureTemplateMixin.java
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove vanilla smoker recipe</name>
  <files>src/main/java/thc/mixin/RecipeManagerMixin.java</files>
  <action>
    Add "smoker" to the REMOVED_RECIPE_PATHS Set in RecipeManagerMixin.java.
    This filters the vanilla smoker recipe during recipe loading.
    Pattern follows existing entries (shield, furnace, blast_furnace, etc.).
  </action>
  <verify>Build passes: ./gradlew build</verify>
  <done>REMOVED_RECIPE_PATHS contains "smoker" string</done>
</task>

<task type="auto">
  <name>Task 2: Create custom smoker recipe with iron</name>
  <files>src/main/resources/data/minecraft/recipe/smoker.json</files>
  <action>
    Create shaped recipe JSON at data/minecraft/recipe/smoker.json.

    Recipe pattern (3x3):
    ```
    I L I    (I = iron_ingot, L = any log)
    L   L    (center empty)
    L L L
    ```

    - Use minecraft namespace to override vanilla recipe
    - Key "I" = minecraft:iron_ingot
    - Key "L" = minecraft:logs (tag for any log type)
    - Result: minecraft:smoker (count 1)

    This gates smoker behind iron acquisition while keeping the log requirement.
    Iron in top corners represents the metal grate of the smoker.
  </action>
  <verify>Recipe JSON is valid: validate structure matches vanilla recipe format</verify>
  <done>smoker.json exists with iron_ingot and logs in recipe</done>
</task>

<task type="auto">
  <name>Task 3: Filter smoker from village structures</name>
  <files>src/main/java/thc/mixin/StructureTemplateMixin.java</files>
  <action>
    Add Blocks.SMOKER to the FILTERED_STRUCTURE_BLOCKS Set in StructureTemplateMixin.java.
    This prevents smokers from spawning in villages and other structures.
    Pattern follows existing entries (Blocks.FURNACE, Blocks.BLAST_FURNACE).
  </action>
  <verify>Build passes: ./gradlew build</verify>
  <done>FILTERED_STRUCTURE_BLOCKS contains Blocks.SMOKER</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `./gradlew build` succeeds without errors
- [ ] RecipeManagerMixin.java contains "smoker" in REMOVED_RECIPE_PATHS
- [ ] StructureTemplateMixin.java contains Blocks.SMOKER in FILTERED_STRUCTURE_BLOCKS
- [ ] smoker.json recipe file exists with correct structure
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No errors or warnings introduced
- Smoker recipe requires iron ingots
- Smoker filtered from structure generation
</success_criteria>

<output>
After completion, create `.planning/phases/30-smoker-gating/30-01-SUMMARY.md`
</output>
