---
phase: 39-simple-entity-behaviors
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/main/kotlin/thc/monster/SimpleEntityBehaviors.kt
  - src/main/kotlin/thc/THC.kt
autonomous: true

must_haves:
  truths:
    - "Spawned vex shows 8 HP (4 hearts) in F3 debug"
    - "Evoker-summoned vexes appear without visible iron swords"
  artifacts:
    - path: "src/main/kotlin/thc/monster/SimpleEntityBehaviors.kt"
      provides: "Vex health reduction and sword removal on ENTITY_LOAD"
      exports: ["register"]
  key_links:
    - from: "SimpleEntityBehaviors.kt"
      to: "THC.kt"
      via: "register() call in onInitialize"
      pattern: "SimpleEntityBehaviors\\.register\\(\\)"
---

<objective>
Implement vex modifications (health reduction and sword removal) using the established ENTITY_LOAD pattern.

Purpose: Vexes are currently too tanky (14 HP) and visually threatening with iron swords. Reducing health to 8 HP (4 hearts) makes them appropriately fragile as summoned minions. Removing swords reduces visual clutter and aligns with THC's simplified mob aesthetics.

Output: SimpleEntityBehaviors.kt with ENTITY_LOAD handler for vex modifications, registered in THC.kt
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/39-simple-entity-behaviors/39-RESEARCH.md
@src/main/kotlin/thc/monster/MonsterModifications.kt
@src/main/kotlin/thc/THC.kt
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SimpleEntityBehaviors.kt with Vex Modifications</name>
  <files>src/main/kotlin/thc/monster/SimpleEntityBehaviors.kt</files>
  <action>
Create SimpleEntityBehaviors.kt in the thc.monster package following the pattern established in MonsterModifications.kt.

Implement:

1. **Object declaration:** `object SimpleEntityBehaviors`

2. **register() function:** Register ServerEntityEvents.ENTITY_LOAD handler for Vex entities

3. **Vex health reduction (FR-12):**
   - Check if entity is Vex using `entity is Vex`
   - Get MAX_HEALTH attribute: `vex.getAttribute(Attributes.MAX_HEALTH)`
   - Set baseValue to 8.0 (4 hearts) - simpler than attribute modifier for permanent change
   - If current health > 8.0f, set health to 8.0f
   - Use guard clause to prevent reapplication on chunk reload

4. **Vex sword removal (FR-13):**
   - Use `vex.setItemSlot(EquipmentSlot.MAINHAND, ItemStack.EMPTY)` to clear weapon
   - This is idempotent (safe to call on reload)

Import requirements:
- net.fabricmc.fabric.api.event.lifecycle.v1.ServerEntityEvents
- net.minecraft.world.entity.EquipmentSlot
- net.minecraft.world.entity.ai.attributes.Attributes
- net.minecraft.world.entity.monster.Vex
- net.minecraft.world.item.ItemStack

Note: Unlike speed modifiers which stack, health baseValue setting is idempotent. No modifier ID needed.
  </action>
  <verify>File exists and compiles: `./gradlew classes`</verify>
  <done>SimpleEntityBehaviors.kt exists with register() function containing ENTITY_LOAD handler for vex health (8 HP) and sword removal</done>
</task>

<task type="auto">
  <name>Task 2: Register SimpleEntityBehaviors in THC.kt</name>
  <files>src/main/kotlin/thc/THC.kt</files>
  <action>
Add registration call for SimpleEntityBehaviors in THC.onInitialize():

1. Add import: `import thc.monster.SimpleEntityBehaviors`

2. In onInitialize(), add after MonsterModifications.register():
   ```kotlin
   SimpleEntityBehaviors.register()
   ```

Place it logically with other monster-related registrations (near MonsterModifications).
  </action>
  <verify>Build succeeds: `./gradlew build`</verify>
  <done>THC.kt imports SimpleEntityBehaviors and calls register() in onInitialize()</done>
</task>

</tasks>

<verification>
1. Build compiles without errors: `./gradlew build`
2. Code review:
   - SimpleEntityBehaviors.kt exists in src/main/kotlin/thc/monster/
   - Uses ENTITY_LOAD pattern consistent with MonsterModifications.kt
   - Vex health set to 8.0 (not 14.0)
   - Vex mainhand cleared with ItemStack.EMPTY
   - THC.kt calls SimpleEntityBehaviors.register()
</verification>

<success_criteria>
- Build passes with no compilation errors
- SimpleEntityBehaviors.kt follows established ENTITY_LOAD pattern
- FR-12: Vex health reduction to 8 HP implemented
- FR-13: Vex sword removal implemented
- Registration wired into THC.kt
</success_criteria>

<output>
After completion, create `.planning/phases/39-simple-entity-behaviors/39-01-SUMMARY.md`
</output>
