---
phase: 46-iron-boat
plan: 03
type: execute
wave: 2
depends_on: ["46-01"]
files_modified:
  - src/main/java/thc/mixin/IronBoatPassengerMixin.java
  - src/main/resources/thc.mixins.json
autonomous: false

must_haves:
  truths:
    - "Player riding iron boat does not take lava damage"
    - "Player riding iron boat does not catch fire from lava"
    - "Passengers of iron boat are protected while in lava"
  artifacts:
    - path: "src/main/java/thc/mixin/IronBoatPassengerMixin.java"
      provides: "Passenger fire/lava damage protection"
      contains: "IronBoatPassengerMixin"
  key_links:
    - from: "src/main/java/thc/mixin/IronBoatPassengerMixin.java"
      to: "IronBoat"
      via: "Vehicle type check"
      pattern: "getVehicle.*instanceof.*IronBoat"
---

<objective>
Protect iron boat passengers from lava and fire damage, then verify full feature.

Purpose: Complete the safe Nether traversal feature by protecting riders, not just the boat.
Output: Mixin that cancels fire/lava damage for iron boat passengers, verified working feature.
</objective>

<execution_context>
@/home/tack/.claude/get-shit-done/workflows/execute-plan.md
@/home/tack/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/46-iron-boat/46-CONTEXT.md
@.planning/phases/46-iron-boat/46-01-SUMMARY.md

# Reference mixin patterns
@src/main/resources/thc.mixins.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Passenger Protection Mixin</name>
  <files>
    src/main/java/thc/mixin/IronBoatPassengerMixin.java
    src/main/resources/thc.mixins.json
  </files>
  <action>
**IronBoatPassengerMixin.java** - Cancel fire/lava damage when riding iron boat:

```java
package thc.mixin;

import net.minecraft.world.damagesource.DamageSource;
import net.minecraft.world.entity.Entity;
import net.minecraft.world.entity.LivingEntity;
import org.spongepowered.asm.mixin.Mixin;
import org.spongepowered.asm.mixin.injection.At;
import org.spongepowered.asm.mixin.injection.Inject;
import org.spongepowered.asm.mixin.injection.callback.CallbackInfoReturnable;
import thc.entity.IronBoat;

@Mixin(LivingEntity.class)
public abstract class IronBoatPassengerMixin {

    @Inject(method = "hurt", at = @At("HEAD"), cancellable = true)
    private void thc$cancelFireDamageInIronBoat(DamageSource source, float amount, CallbackInfoReturnable<Boolean> cir) {
        LivingEntity self = (LivingEntity) (Object) this;
        Entity vehicle = self.getVehicle();

        // Check if riding an iron boat
        if (vehicle instanceof IronBoat) {
            // Cancel fire and lava damage
            if (source.is(net.minecraft.tags.DamageTypeTags.IS_FIRE)) {
                cir.setReturnValue(false);
            }
        }
    }
}
```

Key points:
- Target LivingEntity.hurt() to catch all living passengers
- Use DamageTypeTags.IS_FIRE which includes: lava, fire, on_fire, campfire, hot_floor
- Check getVehicle() instanceof IronBoat
- Cancel with cir.setReturnValue(false)

**thc.mixins.json** - Add mixin to mixins list:
Add `"IronBoatPassengerMixin"` to the mixins array. Keep existing mixins.
  </action>
  <verify>
    - `./gradlew build` succeeds
    - `grep "IronBoatPassengerMixin" src/main/resources/thc.mixins.json` shows registration
  </verify>
  <done>Mixin prevents fire/lava damage for iron boat passengers.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete iron boat feature:
- Custom entity that floats on lava and water
- Only breaks from player attacks (immune to fire/lava/mobs/cacti)
- Drops item with initial velocity toward attacker
- Item is fire-resistant and should float on lava
- Passengers protected from fire/lava damage
- Craftable with 5 iron ingots + magma cream
- Custom texture for entity and icon
  </what-built>
  <how-to-verify>
1. Run `./gradlew runClient` to start the game
2. Open creative inventory, search for "Iron Boat" - should appear with icon
3. Craft test: `/give @p minecraft:iron_ingot 5` and `/give @p minecraft:magma_cream 1`
4. Open crafting table, arrange in minecart shape (I_I / IMI / III) - should produce Iron Boat
5. Place iron boat on water - should float and be rideable like normal boat
6. Place iron boat on lava - should float and be rideable
7. Ride iron boat into lava pool - player should NOT take damage
8. While in boat on lava, verify boat doesn't burn or take damage
9. Exit boat in lava (player will take damage now - expected)
10. Attack the iron boat with sword - should break
11. Verify dropped item flies toward you initially
12. Drop iron boat item into lava - should NOT burn, should float on surface

Expected results:
- All crafting and placement works
- Boat floats on both water and lava
- Passengers are protected from fire/lava
- Only player attacks break the boat
- Dropped item is lava-proof and floats
  </how-to-verify>
  <resume-signal>Type "approved" if all tests pass, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
1. `./gradlew build` completes successfully
2. Mixin registered in thc.mixins.json
3. Manual testing confirms all BOAT requirements met
</verification>

<success_criteria>
- Passenger protection mixin exists and compiles
- Mixin registered in thc.mixins.json
- Human verifies: boat floats on lava
- Human verifies: passengers don't burn in lava
- Human verifies: only player attacks break boat
- Human verifies: dropped item is lava-proof
- Human verifies: recipe works
</success_criteria>

<output>
After completion, create `.planning/phases/46-iron-boat/46-03-SUMMARY.md`
</output>
