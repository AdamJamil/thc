---
phase: 47-saddle-removal
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/main/java/thc/mixin/RecipeManagerMixin.java
  - src/main/java/thc/mixin/AbstractVillagerMixin.java
  - src/main/resources/data/minecraft/loot_table/chests/bastion_hoglin_stable.json
  - src/main/resources/data/minecraft/loot_table/chests/end_city_treasure.json
  - src/main/resources/data/minecraft/loot_table/chests/nether_bridge.json
  - src/main/resources/data/minecraft/loot_table/chests/village/village_weaponsmith.json
  - src/main/resources/data/minecraft/loot_table/chests/village/village_tannery.json
  - src/main/resources/data/minecraft/loot_table/chests/village/village_savanna_house.json
  - src/main/resources/data/minecraft/loot_table/gameplay/fishing/treasure.json
  - src/main/resources/data/minecraft/loot_table/entities/ravager.json
autonomous: true

must_haves:
  truths:
    - "Player cannot craft saddles (recipe book shows no saddle recipe)"
    - "Leatherworker villagers do not offer saddle trades"
    - "Chest loot in structures does not contain saddles"
    - "Ravagers do not drop saddles when killed"
    - "Fishing treasure pool does not include saddles"
  artifacts:
    - path: "src/main/java/thc/mixin/RecipeManagerMixin.java"
      provides: "Recipe removal for saddle"
      contains: '"saddle"'
    - path: "src/main/java/thc/mixin/AbstractVillagerMixin.java"
      provides: "Villager trade filtering for saddle"
      contains: "Items.SADDLE"
    - path: "src/main/resources/data/minecraft/loot_table/entities/ravager.json"
      provides: "Ravager loot without saddle drop"
      min_lines: 3
  key_links:
    - from: "RecipeManagerMixin.java"
      to: "RecipeManager.prepare"
      via: "REMOVED_RECIPE_PATHS set filtering"
      pattern: "REMOVED_RECIPE_PATHS.*saddle"
    - from: "AbstractVillagerMixin.java"
      to: "AbstractVillager.getOffers"
      via: "removeIf on MerchantOffers"
      pattern: "Items\\.SADDLE"
---

<objective>
Remove saddles from all obtainment sources in Minecraft 1.21.11.

Purpose: Eliminating saddles removes mounted combat (horse PvE, strider Nether traversal), forcing players to engage threats on foot and maintaining the core THC principle that risk is required for progress.

Output: Two modified mixins (recipe + villager trade filtering) and 8 new loot table override JSON files that completely prevent saddle acquisition.
</objective>

<execution_context>
@/home/tack/.claude/get-shit-done/workflows/execute-plan.md
@/home/tack/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/47-saddle-removal/47-RESEARCH.md

# Existing pattern files
@src/main/java/thc/mixin/RecipeManagerMixin.java
@src/main/java/thc/mixin/AbstractVillagerMixin.java
</context>

<tasks>

<task type="auto">
  <name>Task 1: Mixin changes for recipe and villager trade removal</name>
  <files>
    src/main/java/thc/mixin/RecipeManagerMixin.java
    src/main/java/thc/mixin/AbstractVillagerMixin.java
  </files>
  <action>
    1. In RecipeManagerMixin.java, add "saddle" to the REMOVED_RECIPE_PATHS Set.of() list.
       - Add after existing entries (e.g., after "sugar_from_sugar_cane")
       - This removes the 1.21.6+ crafting recipe (3 leather + 1 iron)

    2. In AbstractVillagerMixin.java, add a saddle filter line to the thc$removeShieldTrades method:
       - Add: `offers.removeIf(offer -> offer.getResult().is(Items.SADDLE));`
       - Add after existing BELL filter line
       - This removes Leatherworker Master level saddle trades (6 emeralds)

    Both changes follow established project patterns with minimal modification.
  </action>
  <verify>
    Build compiles: `./gradlew build`
  </verify>
  <done>
    RecipeManagerMixin contains "saddle" in REMOVED_RECIPE_PATHS.
    AbstractVillagerMixin filters Items.SADDLE from offers.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create loot table overrides for all saddle sources</name>
  <files>
    src/main/resources/data/minecraft/loot_table/chests/bastion_hoglin_stable.json
    src/main/resources/data/minecraft/loot_table/chests/end_city_treasure.json
    src/main/resources/data/minecraft/loot_table/chests/nether_bridge.json
    src/main/resources/data/minecraft/loot_table/chests/village/village_weaponsmith.json
    src/main/resources/data/minecraft/loot_table/chests/village/village_tannery.json
    src/main/resources/data/minecraft/loot_table/chests/village/village_savanna_house.json
    src/main/resources/data/minecraft/loot_table/gameplay/fishing/treasure.json
    src/main/resources/data/minecraft/loot_table/entities/ravager.json
  </files>
  <action>
    Create 8 loot table JSON files that override vanilla loot tables with saddle entries removed.

    **Process for each file:**
    1. Look up vanilla MC 1.21.11 loot table content (use misode.github.io/loot-table or Minecraft wiki)
    2. Copy full vanilla JSON structure
    3. Remove any entries where `"name": "minecraft:saddle"`
    4. Preserve `random_sequence` field exactly as vanilla
    5. Save to project data pack location

    **Directory structure to create:**
    ```
    src/main/resources/data/minecraft/loot_table/
    ├── chests/
    │   ├── bastion_hoglin_stable.json
    │   ├── end_city_treasure.json
    │   ├── nether_bridge.json
    │   └── village/
    │       ├── village_weaponsmith.json
    │       ├── village_tannery.json
    │       └── village_savanna_house.json
    ├── entities/
    │   └── ravager.json
    └── gameplay/
        └── fishing/
            └── treasure.json
    ```

    **Important notes:**
    - Use `"type": "minecraft:chest"` for chest loot (with namespace)
    - Use `"type": "minecraft:entity"` for mob loot
    - Use `"type": "minecraft:fishing"` for fishing loot
    - Preserve all non-saddle entries exactly as vanilla (weights, functions, conditions)
    - Ravager may have empty pools array after saddle removal (that's correct)

    **Do NOT modify:**
    - Desert pyramid, jungle temple (saddles removed in 1.21.6)
    - Ancient city, dungeon, stronghold altar (saddles removed in 1.21.6)
  </action>
  <verify>
    All 8 JSON files exist with valid JSON syntax: `find src/main/resources/data/minecraft/loot_table -name "*.json" | wc -l` shows increase.
    Grep confirms no saddle entries: `grep -r "saddle" src/main/resources/data/minecraft/loot_table/chests src/main/resources/data/minecraft/loot_table/entities src/main/resources/data/minecraft/loot_table/gameplay 2>/dev/null` returns empty.
  </verify>
  <done>
    8 loot table override files exist.
    None contain "minecraft:saddle" entries.
    JSON is valid (no syntax errors).
  </done>
</task>

<task type="auto">
  <name>Task 3: Build verification and smoke test</name>
  <files>None (verification only)</files>
  <action>
    1. Run full build to ensure all changes compile and resources are valid:
       `./gradlew build`

    2. Verify loot table JSON validity by checking build output for resource errors.

    3. Document any warnings or issues in summary.

    Note: Full in-game testing blocked by existing PlayerSleepMixin issue, but build success confirms:
    - Mixin changes compile correctly
    - JSON resources are valid format
    - Data pack structure is correct
  </action>
  <verify>
    `./gradlew build` succeeds with no errors.
  </verify>
  <done>
    Build passes.
    No resource loading errors in build output.
    Saddle removal implementation complete.
  </done>
</task>

</tasks>

<verification>
1. RecipeManagerMixin.java contains "saddle" in REMOVED_RECIPE_PATHS
2. AbstractVillagerMixin.java contains Items.SADDLE filter
3. All 8 loot table files exist in correct locations
4. No loot table file contains "minecraft:saddle"
5. ./gradlew build succeeds
</verification>

<success_criteria>
- SADL-01: Saddles removed from chest loot (8 loot table overrides)
- SADL-02: Mobs no longer drop saddles (ravager.json override)
- SADL-03: Saddle recipe removed (RecipeManagerMixin)
- Bonus: Villager trades filtered (AbstractVillagerMixin)
</success_criteria>

<output>
After completion, create `.planning/phases/47-saddle-removal/47-01-SUMMARY.md`
</output>
