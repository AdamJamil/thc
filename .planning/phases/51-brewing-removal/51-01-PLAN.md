---
phase: 51-brewing-removal
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/main/java/thc/mixin/StructureTemplateMixin.java
  - src/main/java/thc/mixin/RecipeManagerMixin.java
  - src/main/resources/data/minecraft/loot_table/gameplay/piglin_bartering.json
autonomous: true

must_haves:
  truths:
    - "Brewing stands do not appear in villages"
    - "Brewing stands do not appear in igloos"
    - "Brewing stands do not appear in End ships"
    - "Brewing stand recipe is not in crafting menu"
    - "Piglins do not give Fire Resistance potions when bartering"
  artifacts:
    - path: "src/main/java/thc/mixin/StructureTemplateMixin.java"
      provides: "Structure block filtering for brewing stands"
      contains: "Blocks.BREWING_STAND"
    - path: "src/main/java/thc/mixin/RecipeManagerMixin.java"
      provides: "Recipe removal for brewing stand"
      contains: "brewing_stand"
    - path: "src/main/resources/data/minecraft/loot_table/gameplay/piglin_bartering.json"
      provides: "Piglin bartering without potions"
      contains: "minecraft:barter"
  key_links:
    - from: "StructureTemplateMixin.java"
      to: "FILTERED_STRUCTURE_BLOCKS"
      via: "Set.contains check in redirect"
      pattern: "FILTERED_STRUCTURE_BLOCKS\\.contains"
    - from: "RecipeManagerMixin.java"
      to: "REMOVED_RECIPE_PATHS"
      via: "Set.contains check in injection"
      pattern: "REMOVED_RECIPE_PATHS\\.contains"
    - from: "piglin_bartering.json"
      to: "loot table type"
      via: "type field matching context"
      pattern: "\"type\":\\s*\"minecraft:barter\""
---

<objective>
Remove brewing economy by eliminating brewing stands from all sources and potions from piglin bartering.

Purpose: Potions provide powerful buffs and healing that trivialize combat challenge. Removing the brewing economy forces players to rely on food healing and skill-based combat.

Output: Modified mixins for structure/recipe filtering, new loot table override for piglin bartering.
</objective>

<execution_context>
@/home/tack/.claude/get-shit-done/workflows/execute-plan.md
@/home/tack/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/51-brewing-removal/51-CONTEXT.md
@.planning/phases/51-brewing-removal/51-RESEARCH.md

@src/main/java/thc/mixin/StructureTemplateMixin.java
@src/main/java/thc/mixin/RecipeManagerMixin.java
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add brewing stand to structure block filter</name>
  <files>src/main/java/thc/mixin/StructureTemplateMixin.java</files>
  <action>
Add `Blocks.BREWING_STAND` to the existing `FILTERED_STRUCTURE_BLOCKS` set.

The set currently contains:
```java
Blocks.FURNACE,
Blocks.BLAST_FURNACE,
Blocks.SMOKER
```

Add `Blocks.BREWING_STAND` as the fourth entry. Update the class Javadoc comment to mention brewing stands are filtered.

This automatically prevents brewing stand placement in ALL structures (villages, igloos, End ships) via the existing @Redirect on setBlock.
  </action>
  <verify>Build succeeds: `./gradlew build`</verify>
  <done>FILTERED_STRUCTURE_BLOCKS contains Blocks.BREWING_STAND</done>
</task>

<task type="auto">
  <name>Task 2: Add brewing stand recipe removal</name>
  <files>src/main/java/thc/mixin/RecipeManagerMixin.java</files>
  <action>
Add `"brewing_stand"` to the existing `REMOVED_RECIPE_PATHS` set.

The set currently contains 18 recipe paths. Add `"brewing_stand"` after `"saddle"`.

Use the recipe path string `"brewing_stand"` (NOT `"minecraft:brewing_stand"`) - the mixin extracts only the path portion from recipe IDs.
  </action>
  <verify>Build succeeds: `./gradlew build`</verify>
  <done>REMOVED_RECIPE_PATHS contains "brewing_stand"</done>
</task>

<task type="auto">
  <name>Task 3: Create piglin bartering loot table override</name>
  <files>src/main/resources/data/minecraft/loot_table/gameplay/piglin_bartering.json</files>
  <action>
Create a new loot table file at `data/minecraft/loot_table/gameplay/piglin_bartering.json`.

Copy the complete vanilla piglin bartering loot table and remove ONLY these two entries:
1. Fire Resistance potion (weight 8, has set_potion function with "fire_resistance")
2. Splash Fire Resistance potion (weight 8, has set_potion function with "fire_resistance")

KEEP the water bottle entry (weight 10) - per CONTEXT.md, water bottles have no buff effect and should remain.

Critical format requirements:
- `"type": "minecraft:barter"` (NOT "minecraft:gift" or other types)
- `"random_sequence": "minecraft:gameplay/piglin_bartering"` at root level
- All other vanilla entries preserved exactly (iron nuggets, soul speed books, etc.)

Reference existing loot table override pattern in `src/main/resources/data/minecraft/loot_table/entities/ravager.json` for structure.
  </action>
  <verify>
1. File exists at correct path
2. JSON is valid (no syntax errors)
3. Contains "type": "minecraft:barter"
4. Does NOT contain "fire_resistance" string
5. Build succeeds: `./gradlew build`
  </verify>
  <done>piglin_bartering.json exists with potion entries removed, water bottle retained</done>
</task>

</tasks>

<verification>
1. `./gradlew build` succeeds with no errors
2. StructureTemplateMixin.java contains `Blocks.BREWING_STAND` in FILTERED_STRUCTURE_BLOCKS
3. RecipeManagerMixin.java contains `"brewing_stand"` in REMOVED_RECIPE_PATHS
4. piglin_bartering.json exists and contains "minecraft:barter" type
5. piglin_bartering.json does NOT contain "fire_resistance"
</verification>

<success_criteria>
- BREW-01: Brewing stands filtered from structure generation (StructureTemplateMixin)
- BREW-02: Brewing stand recipe removed (RecipeManagerMixin)
- BREW-03: Fire Resistance potions removed from piglin bartering (loot table override)
- All changes compile successfully
</success_criteria>

<output>
After completion, create `.planning/phases/51-brewing-removal/51-01-SUMMARY.md`
</output>
