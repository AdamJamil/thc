---
phase: 52-armor-rebalancing
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/main/kotlin/thc/armor/ArmorRebalancing.kt
  - src/main/kotlin/thc/THC.kt
autonomous: true

must_haves:
  truths:
    - "Full leather armor provides 7 total armor points"
    - "Full copper armor provides 10 total armor points"
    - "Full iron armor provides 15 total armor points"
    - "Full diamond armor provides 18 armor + 4 toughness"
    - "Full netherite armor provides 20 armor + 6 toughness"
    - "Each tier upgrade gives strictly more protection than previous"
  artifacts:
    - path: "src/main/kotlin/thc/armor/ArmorRebalancing.kt"
      provides: "Armor attribute modifier registration"
      exports: ["ArmorRebalancing.register"]
      min_lines: 100
  key_links:
    - from: "src/main/kotlin/thc/THC.kt"
      to: "ArmorRebalancing.register()"
      via: "Function call in onInitialize"
      pattern: "ArmorRebalancing\\.register\\(\\)"
---

<objective>
Rebalance vanilla armor progression with copper tier insertion and half armor point support.

Purpose: Create clear, monotonic armor progression where each tier is strictly better than the previous. Leather serves as early-game option, copper provides meaningful mid-tier upgrade before iron, and diamond/netherite represent endgame protection.

Output: ArmorRebalancing.kt modifying all 20 vanilla armor items (5 tiers x 4 pieces) with new armor/toughness values.
</objective>

<execution_context>
@/home/tack/.claude/get-shit-done/workflows/execute-plan.md
@/home/tack/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/52-armor-rebalancing/52-CONTEXT.md
@.planning/phases/52-armor-rebalancing/52-RESEARCH.md

# Existing pattern for DefaultItemComponentEvents.MODIFY
@src/main/kotlin/thc/food/FoodStatsModifier.kt
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ArmorRebalancing with attribute modifiers</name>
  <files>src/main/kotlin/thc/armor/ArmorRebalancing.kt</files>
  <action>
Create ArmorRebalancing.kt in new armor/ directory following FoodStatsModifier.kt pattern.

Use DefaultItemComponentEvents.MODIFY to set ATTRIBUTE_MODIFIERS component on each vanilla armor item.

**Per-piece distribution (preserving vanilla ratios, using fractional values):**

| Tier | Helmet | Chest | Legs | Boots | Total | Toughness/piece |
|------|--------|-------|------|-------|-------|-----------------|
| Leather | 1.0 | 3.0 | 2.0 | 1.0 | 7 | 0 |
| Copper | 1.5 | 4.0 | 3.0 | 1.5 | 10 | 0 |
| Iron | 2.0 | 6.0 | 5.0 | 2.0 | 15 | 0 |
| Diamond | 3.0 | 7.0 | 5.0 | 3.0 | 18 | 1.0 |
| Netherite | 3.0 | 8.0 | 6.0 | 3.0 | 20 | 1.5 |

**Implementation details:**
- Use AttributeModifiersComponent.builder() to create new component
- Add Attributes.ARMOR with ADD_VALUE operation
- Add Attributes.ARMOR_TOUGHNESS for diamond/netherite
- Add Attributes.KNOCKBACK_RESISTANCE (0.1) for netherite only
- Use AttributeModifierSlot.HEAD/CHEST/LEGS/FEET matching each piece
- Create unique Identifier for each modifier: "thc", "{material}_{slot}_armor"

**Example for leather helmet:**
```kotlin
val id = Identifier.fromNamespaceAndPath("thc", "leather_helmet_armor")
context.modify(Items.LEATHER_HELMET) { builder ->
    builder.set(DataComponents.ATTRIBUTE_MODIFIERS,
        AttributeModifiersComponent.builder()
            .add(Attributes.ARMOR,
                AttributeModifier(id, 1.0, AttributeModifier.Operation.ADD_VALUE),
                AttributeModifierSlot.HEAD)
            .build())
}
```

**Required imports:**
- net.fabricmc.fabric.api.item.v1.DefaultItemComponentEvents
- net.minecraft.core.component.DataComponents
- net.minecraft.world.entity.ai.attributes.Attributes
- net.minecraft.world.entity.ai.attributes.AttributeModifier
- net.minecraft.world.item.Items
- net.minecraft.world.item.component.ItemAttributeModifiers (for AttributeModifiersComponent)
- net.minecraft.world.entity.EquipmentSlotGroup (for AttributeModifierSlot)
- net.minecraft.resources.ResourceLocation (for Identifier)
  </action>
  <verify>File exists with 20 armor item modifications (5 tiers x 4 pieces)</verify>
  <done>ArmorRebalancing.kt created with complete armor value table</done>
</task>

<task type="auto">
  <name>Task 2: Register ArmorRebalancing in THC.kt</name>
  <files>src/main/kotlin/thc/THC.kt</files>
  <action>
Add ArmorRebalancing.register() call in THC.onInitialize(), after other item component modifications.

Add import: import thc.armor.ArmorRebalancing

Call ArmorRebalancing.register() near other register() calls (e.g., after FoodStatsModifier.register()).
  </action>
  <verify>grep -n "ArmorRebalancing" src/main/kotlin/thc/THC.kt shows import and register call</verify>
  <done>ArmorRebalancing registered in mod initialization</done>
</task>

<task type="auto">
  <name>Task 3: Build and verify</name>
  <files></files>
  <action>
Run gradle build to verify compilation.

Check for any import errors or API mismatches. Common issues:
- AttributeModifierSlot vs EquipmentSlotGroup naming (MC 1.21 uses EquipmentSlotGroup)
- Identifier vs ResourceLocation (use ResourceLocation.fromNamespaceAndPath in MC 1.21.11)
- AttributeModifiersComponent.builder() may be ItemAttributeModifiers.builder()

If build fails, fix import/API issues based on error messages.
  </action>
  <verify>./gradlew build completes with BUILD SUCCESSFUL</verify>
  <done>Mod compiles successfully with armor rebalancing</done>
</task>

</tasks>

<verification>
1. Build succeeds: `./gradlew build` shows BUILD SUCCESSFUL
2. Code inspection: ArmorRebalancing.kt modifies all 20 armor items
3. Math check: Sum of per-piece values matches tier totals (7, 10, 15, 18, 20)
4. Toughness check: Diamond has 4 total (1.0 x 4), Netherite has 6 total (1.5 x 4)
5. Knockback: Only Netherite pieces have knockback resistance (0.1 each = 0.4 total)
</verification>

<success_criteria>
- ArmorRebalancing.kt exists with 20 armor item modifications
- THC.kt imports and registers ArmorRebalancing
- Build completes successfully
- Armor values sum correctly per tier
- Toughness applied only to diamond/netherite
- Knockback resistance preserved for netherite
</success_criteria>

<output>
After completion, create `.planning/phases/52-armor-rebalancing/52-01-SUMMARY.md`
</output>
