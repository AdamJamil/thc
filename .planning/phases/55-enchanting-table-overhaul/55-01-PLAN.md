---
phase: 55-enchanting-table-overhaul
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/main/kotlin/thc/item/THCItems.kt
  - src/main/resources/assets/thc/models/item/soul_dust.json
  - src/main/resources/assets/thc/lang/en_us.json
  - src/main/kotlin/thc/enchant/EnchantmentEnforcement.kt
autonomous: true

must_haves:
  truths:
    - "Soul Dust item exists and can be held in inventory"
    - "Soul Dust appears in Tools & Utilities creative tab"
    - "Stage classification returns correct level requirements (10/20/30)"
  artifacts:
    - path: "src/main/kotlin/thc/item/THCItems.kt"
      provides: "SOUL_DUST item registration"
      contains: "SOUL_DUST"
    - path: "src/main/resources/assets/thc/models/item/soul_dust.json"
      provides: "Soul Dust item model"
      contains: "soul_dust"
    - path: "src/main/kotlin/thc/enchant/EnchantmentEnforcement.kt"
      provides: "Stage tier classification and level requirements"
      contains: "getStageForEnchantment"
  key_links:
    - from: "THCItems.kt"
      to: "assets/thc/models/item/soul_dust.json"
      via: "item registration uses model path thc:item/soul_dust"
---

<objective>
Create Soul Dust item and extend enchantment stage classification for tiered level requirements.

Purpose: Establishes the new crafting ingredient and the stage-based level requirement system needed by the enchanting table overhaul.
Output: SOUL_DUST item in THCItems.kt, soul_dust model/lang files, extended EnchantmentEnforcement.kt with getStageForEnchantment() and getLevelRequirementForStage().
</objective>

<execution_context>
@/home/tack/.claude/get-shit-done/workflows/execute-plan.md
@/home/tack/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/main/kotlin/thc/item/THCItems.kt
@src/main/kotlin/thc/enchant/EnchantmentEnforcement.kt
</context>

<tasks>

<task type="auto">
  <name>Task 1: Register Soul Dust item</name>
  <files>
    src/main/kotlin/thc/item/THCItems.kt
    src/main/resources/assets/thc/models/item/soul_dust.json
    src/main/resources/assets/thc/lang/en_us.json
  </files>
  <action>
Register SOUL_DUST as a simple Item in THCItems.kt following the existing HONEY_APPLE pattern:

```kotlin
@JvmField
val SOUL_DUST: Item = register("soul_dust") { key ->
    Item(
        Item.Properties()
            .setId(key)
            .stacksTo(64)
    )
}
```

Add to toolsTabKey creative tab entries in init() alongside BLAST_TOTEM.

Create soul_dust.json model file:
```json
{
  "parent": "minecraft:item/generated",
  "textures": {
    "layer0": "thc:item/soul_dust"
  }
}
```
Texture already exists at assets/thc/textures/item/soul_dust.png.

Add to en_us.json: `"item.thc.soul_dust": "Soul Dust"`
  </action>
  <verify>Run `./gradlew build` - should compile without errors. Verify soul_dust.json and lang entry exist.</verify>
  <done>SOUL_DUST item registered, model file created, translation added, appears in creative tab.</done>
</task>

<task type="auto">
  <name>Task 2: Extend stage classification for enchanting table</name>
  <files>src/main/kotlin/thc/enchant/EnchantmentEnforcement.kt</files>
  <action>
Extend EnchantmentEnforcement.kt with:

1. STAGE_4_5_ENCHANTMENTS set containing high-tier enchantments:
```kotlin
val STAGE_4_5_ENCHANTMENTS = setOf(
    // Stage 4-5: Require level 30
    "minecraft:flame",
    "minecraft:fire_aspect",
    "minecraft:looting",
    "minecraft:feather_falling",
    "minecraft:respiration",
    "minecraft:aqua_affinity",
    "minecraft:depth_strider",
    "minecraft:frost_walker",
    "minecraft:fire_protection"
)
```

2. getStageForEnchantment() function:
```kotlin
fun getStageForEnchantment(enchantId: String?): Int {
    if (enchantId == null) return 0
    return when {
        STAGE_1_2_ENCHANTMENTS.contains(enchantId) -> 1  // Stage 1-2
        STAGE_4_5_ENCHANTMENTS.contains(enchantId) -> 4  // Stage 4-5
        else -> 3  // Default to stage 3
    }
}
```

3. getLevelRequirementForStage() function:
```kotlin
fun getLevelRequirementForStage(stage: Int): Int = when {
    stage <= 2 -> 10   // Stage 1-2: level 10
    stage == 3 -> 20   // Stage 3: level 20
    else -> 30         // Stage 4-5: level 30
}
```

Note: Cost is always 3 levels regardless of stage per CONTEXT.md.
  </action>
  <verify>Run `./gradlew build`. Verify EnchantmentEnforcement.kt contains new functions.</verify>
  <done>Stage classification functions exist: getStageForEnchantment returns 1/3/4 based on enchant ID, getLevelRequirementForStage returns 10/20/30 based on stage.</done>
</task>

</tasks>

<verification>
1. `./gradlew build` completes successfully
2. soul_dust.json model file exists at src/main/resources/assets/thc/models/item/
3. en_us.json contains "item.thc.soul_dust" entry
4. EnchantmentEnforcement.kt contains STAGE_4_5_ENCHANTMENTS, getStageForEnchantment, getLevelRequirementForStage
</verification>

<success_criteria>
- Build passes
- SOUL_DUST item registered and appears in creative tab
- Stage classification returns correct values (stage 1-2 -> 10, stage 3 -> 20, stage 4-5 -> 30)
</success_criteria>

<output>
After completion, create `.planning/phases/55-enchanting-table-overhaul/55-01-SUMMARY.md`
</output>
