---
phase: 56-acquisition-gating
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - data/minecraft/loot_table/entities/drowned.json
  - data/minecraft/loot_table/entities/spider.json
  - data/minecraft/loot_table/entities/husk.json
  - data/minecraft/loot_table/entities/stray.json
  - data/minecraft/loot_table/entities/blaze.json
  - data/minecraft/loot_table/entities/magma_cube.json
autonomous: true

must_haves:
  truths:
    - "Drowned drop aqua affinity, depth strider, frost walker, respiration books at 2.5% each"
    - "Spiders drop bane of arthropods book at 2.5%"
    - "Husks drop smite book at 2.5%"
    - "Strays drop smite book at 2.5%"
    - "Blazes drop fire protection book at 2.5%"
    - "Magma cubes drop flame and fire aspect books at 5% each"
    - "Looting adds flat +1% to all book drop rates"
    - "Baby mobs do not drop enchantment books"
    - "Any death source triggers drops (not player-kill restricted)"
  artifacts:
    - path: "data/minecraft/loot_table/entities/drowned.json"
      provides: "Enchanted book pools for water enchantments"
      contains: "aqua_affinity"
    - path: "data/minecraft/loot_table/entities/spider.json"
      provides: "Bane of arthropods book pool"
      contains: "bane_of_arthropods"
    - path: "data/minecraft/loot_table/entities/husk.json"
      provides: "Smite book pool"
      contains: "smite"
    - path: "data/minecraft/loot_table/entities/stray.json"
      provides: "Smite book pool"
      contains: "smite"
    - path: "data/minecraft/loot_table/entities/blaze.json"
      provides: "Fire protection book pool"
      contains: "fire_protection"
    - path: "data/minecraft/loot_table/entities/magma_cube.json"
      provides: "Flame and fire aspect book pools"
      contains: "flame"
  key_links:
    - from: "drowned.json"
      to: "minecraft:enchanted_book"
      via: "set_enchantments function"
      pattern: "set_enchantments"
---

<objective>
Add enchanted book drops to specific mob loot tables with precise drop rates and Looting bonus mechanics.

Purpose: Create exclusive acquisition paths for stage 3+ enchantments through targeted mob farming.
Output: Updated loot table JSON files for drowned, spider, husk, stray, blaze, and magma_cube with enchanted book pools.
</objective>

<execution_context>
@/home/tack/.claude/get-shit-done/workflows/execute-plan.md
@/home/tack/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/56-acquisition-gating/56-RESEARCH.md
@data/minecraft/loot_table/entities/drowned.json
@data/minecraft/loot_table/entities/spider.json
@data/minecraft/loot_table/entities/husk.json
@data/minecraft/loot_table/entities/stray.json
@data/minecraft/loot_table/entities/blaze.json
@data/minecraft/loot_table/entities/magma_cube.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add drowned enchanted book pools (4 enchantments)</name>
  <files>data/minecraft/loot_table/entities/drowned.json</files>
  <action>
Add FOUR new pools to drowned.json for: aqua_affinity, depth_strider, frost_walker, respiration.
Each pool is independent (can drop multiple books).

For each enchantment, add a pool with this structure:
- Condition: is_baby false (adults only)
- Condition: random_chance_with_enchanted_bonus with unenchanted_chance 0.025 (2.5%), enchanted_chance base 0.035 (+1% with any Looting), per_level_above_first 0.0 (flat bonus)
- NO killed_by_player condition (any death source)
- Entry: enchanted_book with set_enchantments function setting the specific enchantment to level 1

Template for each pool (replace ENCHANTMENT_ID):
```json
{
  "bonus_rolls": 0.0,
  "conditions": [
    {
      "condition": "minecraft:entity_properties",
      "entity": "this",
      "predicate": {
        "flags": {
          "is_baby": false
        }
      }
    },
    {
      "condition": "minecraft:random_chance_with_enchanted_bonus",
      "enchantment": "minecraft:looting",
      "enchanted_chance": {
        "type": "minecraft:linear",
        "base": 0.035,
        "per_level_above_first": 0.0
      },
      "unenchanted_chance": 0.025
    }
  ],
  "entries": [
    {
      "type": "minecraft:item",
      "name": "minecraft:enchanted_book",
      "functions": [
        {
          "function": "minecraft:set_enchantments",
          "enchantments": {
            "minecraft:ENCHANTMENT_ID": 1
          }
        }
      ]
    }
  ],
  "rolls": 1.0
}
```

Add pools for:
- minecraft:aqua_affinity (level 1)
- minecraft:depth_strider (level 1)
- minecraft:frost_walker (level 1)
- minecraft:respiration (level 1)
  </action>
  <verify>JSON is valid: `python3 -c "import json; json.load(open('data/minecraft/loot_table/entities/drowned.json'))"` succeeds. Verify 4 new pools with is_baby condition and 0.025 unenchanted_chance.</verify>
  <done>drowned.json has 4 new enchanted book pools for water enchantments at 2.5% base rate with flat +1% Looting bonus, adults only.</done>
</task>

<task type="auto">
  <name>Task 2: Add remaining mob enchanted book pools (5 mobs)</name>
  <files>
    data/minecraft/loot_table/entities/spider.json
    data/minecraft/loot_table/entities/husk.json
    data/minecraft/loot_table/entities/stray.json
    data/minecraft/loot_table/entities/blaze.json
    data/minecraft/loot_table/entities/magma_cube.json
  </files>
  <action>
Add enchanted book pools to each mob's loot table.

**spider.json** - Add 1 pool:
- bane_of_arthropods (level 1)
- 2.5% base, 3.5% with Looting
- is_baby: false condition
- NO killed_by_player

**husk.json** - Add 1 pool:
- smite (level 1)
- 2.5% base, 3.5% with Looting
- is_baby: false condition
- NO killed_by_player

**stray.json** - Add 1 pool:
- smite (level 1)
- 2.5% base, 3.5% with Looting
- is_baby: false condition (strays can't be babies but add for consistency)
- NO killed_by_player

**blaze.json** - Add 1 pool:
- fire_protection (level 1)
- 2.5% base, 3.5% with Looting
- NO is_baby condition (blazes cannot be babies)
- NO killed_by_player

**magma_cube.json** - Add 2 pools (independent rolls):
- flame (level 1) - 5% base, 6% with Looting
- fire_aspect (level 1) - 5% base, 6% with Looting
- Add size >= 2 condition (same as magma cream)
- NO killed_by_player

For 2.5% drops use: unenchanted_chance: 0.025, base: 0.035
For 5% drops use: unenchanted_chance: 0.05, base: 0.06

Magma cube size condition:
```json
{
  "condition": "minecraft:entity_properties",
  "entity": "this",
  "predicate": {
    "type_specific": {
      "type": "minecraft:slime",
      "size": {
        "min": 2
      }
    }
  }
}
```
  </action>
  <verify>All 5 JSON files are valid: `for f in spider husk stray blaze magma_cube; do python3 -c "import json; json.load(open('data/minecraft/loot_table/entities/${f}.json'))"; done`. Verify each file has the correct enchantment(s) and drop rates.</verify>
  <done>spider.json, husk.json, stray.json, blaze.json, and magma_cube.json have enchanted book pools with correct enchantments and drop rates.</done>
</task>

</tasks>

<verification>
1. All JSON files are valid syntax
2. Each mob has correct enchantments:
   - Drowned: aqua_affinity, depth_strider, frost_walker, respiration (4 pools)
   - Spider: bane_of_arthropods (1 pool)
   - Husk: smite (1 pool)
   - Stray: smite (1 pool)
   - Blaze: fire_protection (1 pool)
   - Magma Cube: flame, fire_aspect (2 pools)
3. Drop rates: 2.5% base with 3.5% looting OR 5% base with 6% looting
4. Adults only: is_baby: false where applicable
5. NO killed_by_player condition on any pool
6. Build succeeds: `./gradlew build`
</verification>

<success_criteria>
- 6 loot table files updated with 10 total enchanted book pools
- All pools use correct drop rates (2.5%/3.5% or 5%/6%)
- No killed_by_player restrictions
- is_baby: false on drowned, spider, husk (size >= 2 on magma cube)
- Build compiles successfully
</success_criteria>

<output>
After completion, create `.planning/phases/56-acquisition-gating/56-02-SUMMARY.md`
</output>
