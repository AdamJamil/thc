---
phase: 63-combat-balancing
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/main/resources/data/minecraft/recipe/arrow.json
  - src/main/java/thc/mixin/AbstractArrowMixin.java
autonomous: true

must_haves:
  truths:
    - "Crafting 1 flint + 1 stick + 1 feather yields 16 arrows"
    - "Pillager crossbow arrows deal 3-5 damage instead of 5-7"
    - "Stray bow arrows deal 2-4 damage instead of 4-8"
  artifacts:
    - path: "src/main/resources/data/minecraft/recipe/arrow.json"
      provides: "Arrow recipe override with count 16"
      contains: '"count": 16'
    - path: "src/main/java/thc/mixin/AbstractArrowMixin.java"
      provides: "Enemy arrow damage reduction"
      contains: "EntityType.PILLAGER"
  key_links:
    - from: "arrow.json"
      to: "minecraft:arrow"
      via: "recipe override"
      pattern: '"id": "minecraft:arrow"'
    - from: "AbstractArrowMixin.java"
      to: "baseDamage field"
      via: "owner type check"
      pattern: "owner.getType\\(\\) == EntityType\\.(PILLAGER|STRAY)"
---

<objective>
Adjust arrow economy and enemy arrow damage for better combat pacing.

Purpose: Players need more arrows to engage in ranged combat effectively, and enemy archers (Pillagers and Strays) currently deal too much damage, making encounters frustrating rather than challenging.

Output: Arrow recipe yields 16 (4x vanilla), Pillager and Stray arrow damage reduced by ~33% and ~50% respectively.
</objective>

<execution_context>
@/home/tack/.claude/get-shit-done/workflows/execute-plan.md
@/home/tack/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/63-combat-balancing/63-RESEARCH.md

# Existing patterns
@src/main/resources/data/minecraft/recipe/ladder.json
@src/main/java/thc/mixin/AbstractArrowMixin.java
</context>

<tasks>

<task type="auto">
  <name>Task 1: Arrow recipe yield increase</name>
  <files>src/main/resources/data/minecraft/recipe/arrow.json</files>
  <action>
Create arrow recipe JSON override following the existing ladder.json pattern.

Recipe details:
- Type: minecraft:crafting_shaped
- Category: equipment
- Pattern: vertical (X on top, # middle, Y bottom)
- Keys: X=minecraft:flint, #=minecraft:stick, Y=minecraft:feather
- Result: count 16, id minecraft:arrow

This overrides vanilla's arrow.json which yields 4 arrows.
  </action>
  <verify>File exists at src/main/resources/data/minecraft/recipe/arrow.json with count: 16</verify>
  <done>Arrow recipe override created with 16 yield</done>
</task>

<task type="auto">
  <name>Task 2: Pillager and Stray arrow damage reduction</name>
  <files>src/main/java/thc/mixin/AbstractArrowMixin.java</files>
  <action>
Extend the existing HEAD injection in onHitEntity to handle enemy arrows.

Add BEFORE the player-only check (line ~43 `if (!(owner instanceof ServerPlayer player))`):

1. Import EntityType: `import net.minecraft.world.entity.EntityType;`

2. Add Pillager damage reduction:
   - Check: `if (owner != null && owner.getType() == EntityType.PILLAGER)`
   - Multiplier: 0.667 (reduces 5-7 to ~3.3-4.7, rounds to 3-5)
   - Apply: `baseDamage = baseDamage * 0.667;`

3. Add Stray damage reduction:
   - Check: `if (owner != null && owner.getType() == EntityType.STRAY)`
   - Multiplier: 0.5 (reduces 4-8 to 2-4)
   - Apply: `baseDamage = baseDamage * 0.5;`

Note: These checks must happen BEFORE the player-only return statement, and there's no need to restore baseDamage after for enemy arrows (they don't need the restore-after-damage pattern that player arrows use).

The multipliers are applied to baseDamage before vanilla damage calculation, preserving difficulty scaling and any other modifiers.
  </action>
  <verify>`./gradlew build` succeeds; AbstractArrowMixin.java contains EntityType.PILLAGER and EntityType.STRAY checks</verify>
  <done>Pillager arrows reduced to ~67% damage, Stray arrows reduced to 50% damage</done>
</task>

</tasks>

<verification>
1. `./gradlew build` completes without errors
2. arrow.json exists with count: 16
3. AbstractArrowMixin.java imports EntityType
4. AbstractArrowMixin.java contains PILLAGER and STRAY damage reduction logic
</verification>

<success_criteria>
- CMBT-01: Arrow recipe yields 16 (verified by JSON content)
- CMBT-02: Pillager arrow damage multiplied by 0.667 (code inspection)
- CMBT-03: Stray arrow damage multiplied by 0.5 (code inspection)
- Build succeeds without errors
</success_criteria>

<output>
After completion, create `.planning/phases/63-combat-balancing/63-01-SUMMARY.md`
</output>
