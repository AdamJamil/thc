---
phase: 66-structure-locators
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/main/kotlin/thc/item/StructureLocatorItem.kt
  - src/main/kotlin/thc/item/THCItems.kt
autonomous: true

must_haves:
  truths:
    - "StructureLocatorItem class exists with inventoryTick structure search"
    - "All 6 locator items registered in THCItems"
    - "Locators update lodestone_tracker component with found position"
    - "Wrong dimension clears target (causes spinning needle)"
    - "Search is throttled to every 20 ticks"
  artifacts:
    - path: "src/main/kotlin/thc/item/StructureLocatorItem.kt"
      provides: "Base compass-style item with structure search logic"
      contains: "class StructureLocatorItem"
    - path: "src/main/kotlin/thc/item/THCItems.kt"
      provides: "6 registered locator items"
      contains: "FORTRESS_LOCATOR"
  key_links:
    - from: "StructureLocatorItem.inventoryTick"
      to: "ServerLevel.findNearestMapStructure"
      via: "structure search call"
      pattern: "findNearestMapStructure"
    - from: "StructureLocatorItem"
      to: "DataComponents.LODESTONE_TRACKER"
      via: "component update"
      pattern: "LODESTONE_TRACKER"
---

<objective>
Create the base StructureLocatorItem class and register all 6 structure locator items.

Purpose: Provides the core compass-style behavior for pointing to structures. The base class handles server-side structure search, dimension checking, and lodestone_tracker component updates.

Output: StructureLocatorItem.kt base class and 6 registered items in THCItems.kt
</objective>

<execution_context>
@/home/tack/.claude/get-shit-done/workflows/execute-plan.md
@/home/tack/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/66-structure-locators/66-RESEARCH.md
@.planning/phases/66-structure-locators/66-CONTEXT.md
@src/main/kotlin/thc/item/THCItems.kt
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create StructureLocatorItem base class</name>
  <files>src/main/kotlin/thc/item/StructureLocatorItem.kt</files>
  <action>
Create StructureLocatorItem class that extends Item with:

Constructor parameters:
- properties: Item.Properties
- structureTag: TagKey<Structure> - structure type to locate
- expectedDimension: ResourceKey<Level> - dimension where this locator works

Override inventoryTick():
1. Early return if level.isClientSide or entity !is Player
2. Throttle: only search if level.gameTime % 20 == 0L (every second)
3. Cast level to ServerLevel
4. Dimension check: if serverLevel.dimension() != expectedDimension, call clearTarget(stack) and return
5. Call serverLevel.findNearestMapStructure(structureTag, entity.blockPosition(), 100, false)
6. If found != null, call setTarget(stack, dimension, pos)
7. If found == null, call clearTarget(stack)

Private helper setTarget(stack, dimension, pos):
- Create LodestoneTracker(Optional.of(GlobalPos.of(dimension, pos)), false)
- stack.set(DataComponents.LODESTONE_TRACKER, tracker)

Private helper clearTarget(stack):
- Create LodestoneTracker(Optional.empty(), false)
- stack.set(DataComponents.LODESTONE_TRACKER, tracker)

Important: tracked=false in LodestoneTracker to prevent vanilla from removing component

Use imports:
- net.minecraft.core.component.DataComponents
- net.minecraft.world.item.component.LodestoneTracker
- net.minecraft.core.GlobalPos
- net.minecraft.tags.TagKey
- net.minecraft.world.level.levelgen.structure.Structure
- net.minecraft.resources.ResourceKey
- net.minecraft.world.level.Level
- net.minecraft.server.level.ServerLevel
- java.util.Optional
  </action>
  <verify>File exists and contains class definition with inventoryTick override</verify>
  <done>StructureLocatorItem.kt compiles with structure search logic</done>
</task>

<task type="auto">
  <name>Task 2: Register all 6 locator items</name>
  <files>src/main/kotlin/thc/item/THCItems.kt</files>
  <action>
Add 6 locator item registrations following existing patterns:

1. Add import for StructureLocatorItem
2. Add imports for structure tags and dimensions:
   - net.minecraft.tags.StructureTags (for available tags)
   - net.minecraft.world.level.Level (for OVERWORLD, NETHER)
   - net.minecraft.tags.TagKey
   - net.minecraft.core.registries.Registries
   - net.minecraft.world.level.levelgen.structure.Structure

3. Create custom TagKeys for structures without built-in tags:
   For structures not in StructureTags, create TagKey inline:
   - TagKey.create(Registries.STRUCTURE, Identifier.of("minecraft", "fortress"))
   - TagKey.create(Registries.STRUCTURE, Identifier.of("minecraft", "bastion_remnant"))
   etc.

4. Register items:
   - FORTRESS_LOCATOR: StructureLocatorItem(..., fortressTag, Level.NETHER)
   - BASTION_LOCATOR: StructureLocatorItem(..., bastionTag, Level.NETHER)
   - TRIAL_CHAMBER_LOCATOR: StructureLocatorItem(..., trialChamberTag, Level.OVERWORLD)
   - PILLAGER_OUTPOST_LOCATOR: StructureLocatorItem(..., outpostTag, Level.OVERWORLD)
   - ANCIENT_CITY_LOCATOR: StructureLocatorItem(..., ancientCityTag, Level.OVERWORLD)
   - STRONGHOLD_LOCATOR: StructureLocatorItem(..., strongholdTag, Level.OVERWORLD)

5. All items: .stacksTo(1)

6. Add to tools creative tab in init() method

Note: Check if StructureTags has constants for target structures. If not, create TagKey manually. The stronghold uses StructureTags.EYE_OF_ENDER_LOCATED which contains stronghold.
  </action>
  <verify>gradle build succeeds with no errors</verify>
  <done>6 locator items registered and appear in creative tools tab</done>
</task>

</tasks>

<verification>
1. `./gradlew build` compiles without errors
2. All 6 items registered in THCItems object
3. StructureLocatorItem contains inventoryTick with findNearestMapStructure call
4. LodestoneTracker component used with tracked=false
5. Search radius is 100 chunks
6. Dimension check implemented
</verification>

<success_criteria>
- Code compiles successfully
- 6 locator item constants exist in THCItems
- StructureLocatorItem implements compass-style structure search
- Search throttled to every 20 ticks
- Wrong dimension causes target clear (spinning needle)
</success_criteria>

<output>
After completion, create `.planning/phases/66-structure-locators/66-01-SUMMARY.md`
</output>
