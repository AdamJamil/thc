---
phase: 68-custom-trade-tables
plan: 03
type: execute
wave: 2
depends_on: ["68-01"]
files_modified:
  - src/main/java/thc/villager/CustomTradeTables.java
autonomous: true

must_haves:
  truths:
    - "Butcher has 8 trades across 5 levels (all deterministic)"
    - "Mason has 10 trades across 5 levels (4 deterministic, 6 with 50/50 variants)"
    - "Cartographer has 10 trades across 5 levels (all deterministic, uses structure locators)"
    - "Cartographer trades use THCItems structure locator items"
  artifacts:
    - path: "src/main/java/thc/villager/CustomTradeTables.java"
      provides: "Complete butcher, mason, cartographer trade implementations"
      contains: "getButcherTrades"
  key_links:
    - from: "getCartographerTrades"
      to: "THCItems"
      via: "structure locator item references"
      pattern: "THCItems\\.(FORTRESS_LOCATOR|BASTION_LOCATOR|TRIAL_CHAMBER_LOCATOR)"
---

<objective>
Implement all remaining profession trades: Butcher (TBUT-01 through TBUT-08), Mason (TMAS-01 through TMAS-10), and Cartographer (TCRT-01 through TCRT-10).

Purpose: Complete the trade table implementation for all 4 allowed professions.
Output: Full trade coverage for butcher, mason, and cartographer professions.
</objective>

<execution_context>
@/home/tack/.claude/get-shit-done/workflows/execute-plan.md
@/home/tack/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/68-custom-trade-tables/68-CONTEXT.md
@.planning/phases/68-custom-trade-tables/68-RESEARCH.md
@.planning/phases/68-custom-trade-tables/68-01-SUMMARY.md
@.planning/REQUIREMENTS.md (TBUT, TMAS, TCRT requirements)
@src/main/kotlin/thc/item/THCItems.kt
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement butcher trades</name>
  <files>src/main/java/thc/villager/CustomTradeTables.java</files>
  <action>
Add to CustomTradeTables.java:

1. Add private method for butcher trades:

```java
/**
 * Get butcher trades for a specific level.
 * All butcher trades are deterministic (no 50/50 variants).
 * Per REQUIREMENTS.md TBUT-01 through TBUT-08.
 */
private static List<MerchantOffer> getButcherTrades(int level) {
    return switch (level) {
        case 1 -> List.of(
            // TBUT-01: 4 raw chicken -> 1e
            createSimpleTrade(Items.CHICKEN, 4, Items.EMERALD, 1),
            // TBUT-02: 5 raw porkchop -> 1e
            createSimpleTrade(Items.PORKCHOP, 5, Items.EMERALD, 1)
        );
        case 2 -> List.of(
            // TBUT-03: 5 raw beef -> 1e
            createSimpleTrade(Items.BEEF, 5, Items.EMERALD, 1),
            // TBUT-04: 3 raw mutton -> 1e
            createSimpleTrade(Items.MUTTON, 3, Items.EMERALD, 1)
        );
        case 3 -> List.of(
            // TBUT-05: 1e -> 6 cooked porkchop
            createSimpleTrade(Items.EMERALD, 1, Items.COOKED_PORKCHOP, 6),
            // TBUT-06: 1e -> 5 steak
            createSimpleTrade(Items.EMERALD, 1, Items.COOKED_BEEF, 5)
        );
        case 4 -> List.of(
            // TBUT-07: 10 dried kelp blocks -> 1e
            createSimpleTrade(Items.DRIED_KELP_BLOCK, 10, Items.EMERALD, 1)
        );
        case 5 -> List.of(
            // TBUT-08: 10 sweet berries -> 1e
            createSimpleTrade(Items.SWEET_BERRIES, 10, Items.EMERALD, 1)
        );
        default -> List.of();
    };
}
```

2. Update getTradesFor() dispatcher to call getButcherTrades():
```java
if (profession.location().equals(VillagerProfession.BUTCHER.location())) {
    return getButcherTrades(level);
}
```
  </action>
  <verify>File compiles: `cd /mnt/c/home/code/thc && ./gradlew compileJava 2>&1 | tail -20`</verify>
  <done>All 8 butcher trades implemented (TBUT-01 through TBUT-08)</done>
</task>

<task type="auto">
  <name>Task 2: Implement mason trades</name>
  <files>src/main/java/thc/villager/CustomTradeTables.java</files>
  <action>
Add to CustomTradeTables.java:

1. Add private method for mason trades:

```java
/**
 * Get mason trades for a specific level.
 * Level 1 is deterministic, levels 2-5 have 50/50 variants.
 * Per REQUIREMENTS.md TMAS-01 through TMAS-10.
 */
private static List<MerchantOffer> getMasonTrades(int level, RandomSource random) {
    return switch (level) {
        case 1 -> List.of(
            // TMAS-01: 1e -> 64 cobblestone (deterministic)
            createSimpleTrade(Items.EMERALD, 1, Items.COBBLESTONE, 64),
            // TMAS-02: 1e -> 64 stone bricks (deterministic)
            createSimpleTrade(Items.EMERALD, 1, Items.STONE_BRICKS, 64),
            // TMAS-03: 1e -> 64 bricks (deterministic)
            createSimpleTrade(Items.EMERALD, 1, Items.BRICKS, 64),
            // TMAS-04: 1e -> 64 polished andesite (deterministic)
            createSimpleTrade(Items.EMERALD, 1, Items.POLISHED_ANDESITE, 64)
        );
        case 2 -> List.of(
            // TMAS-05: 1e -> 64 polished granite OR 1e -> 64 polished diorite (50/50)
            getVariantTrade(random,
                () -> createSimpleTrade(Items.EMERALD, 1, Items.POLISHED_GRANITE, 64),
                () -> createSimpleTrade(Items.EMERALD, 1, Items.POLISHED_DIORITE, 64)
            ),
            // TMAS-06: 1e -> 64 smooth stone OR 1e -> 64 calcite (50/50)
            getVariantTrade(random,
                () -> createSimpleTrade(Items.EMERALD, 1, Items.SMOOTH_STONE, 64),
                () -> createSimpleTrade(Items.EMERALD, 1, Items.CALCITE, 64)
            )
        );
        case 3 -> List.of(
            // TMAS-07: 1e -> 64 tuff OR 1e -> 64 mud bricks (50/50)
            getVariantTrade(random,
                () -> createSimpleTrade(Items.EMERALD, 1, Items.TUFF, 64),
                () -> createSimpleTrade(Items.EMERALD, 1, Items.MUD_BRICKS, 64)
            ),
            // TMAS-08: 1e -> 32 deepslate bricks OR 1e -> 32 deepslate tiles (50/50)
            getVariantTrade(random,
                () -> createSimpleTrade(Items.EMERALD, 1, Items.DEEPSLATE_BRICKS, 32),
                () -> createSimpleTrade(Items.EMERALD, 1, Items.DEEPSLATE_TILES, 32)
            )
        );
        case 4 -> List.of(
            // TMAS-09: 1e -> 32 polished blackstone OR 1e -> 32 polished blackstone bricks (50/50)
            getVariantTrade(random,
                () -> createSimpleTrade(Items.EMERALD, 1, Items.POLISHED_BLACKSTONE, 32),
                () -> createSimpleTrade(Items.EMERALD, 1, Items.POLISHED_BLACKSTONE_BRICKS, 32)
            )
        );
        case 5 -> List.of(
            // TMAS-10: 1e -> 16 copper block OR 1e -> 16 quartz block (50/50)
            getVariantTrade(random,
                () -> createSimpleTrade(Items.EMERALD, 1, Items.COPPER_BLOCK, 16),
                () -> createSimpleTrade(Items.EMERALD, 1, Items.QUARTZ_BLOCK, 16)
            )
        );
        default -> List.of();
    };
}
```

2. Update getTradesFor() dispatcher to call getMasonTrades():
```java
if (profession.location().equals(VillagerProfession.MASON.location())) {
    return getMasonTrades(level, random);
}
```
  </action>
  <verify>File compiles: `cd /mnt/c/home/code/thc && ./gradlew compileJava 2>&1 | tail -20`</verify>
  <done>All 10 mason trades implemented (TMAS-01 through TMAS-10)</done>
</task>

<task type="auto">
  <name>Task 3: Implement cartographer trades with structure locators</name>
  <files>src/main/java/thc/villager/CustomTradeTables.java</files>
  <action>
Add to CustomTradeTables.java:

1. Add import for THCItems:
   - `import thc.item.THCItems;`

2. Add helper method for locator trades:

```java
/**
 * Creates a structure locator trade for cartographer.
 * @param emeraldCost Emerald cost for the trade
 * @param locator Structure locator item from THCItems
 * @return MerchantOffer for the locator trade
 */
public static MerchantOffer createLocatorTrade(int emeraldCost, Item locator) {
    return new MerchantOffer(
        new ItemCost(Items.EMERALD, emeraldCost),
        Optional.empty(),
        new ItemStack(locator, 1),
        0, Integer.MAX_VALUE, 0, 0.05f
    );
}
```

3. Add private method for cartographer trades:

```java
/**
 * Get cartographer trades for a specific level.
 * All cartographer trades are deterministic.
 * Structure locators from Phase 66 are sold at higher levels.
 * Per REQUIREMENTS.md TCRT-01 through TCRT-10.
 */
private static List<MerchantOffer> getCartographerTrades(int level) {
    return switch (level) {
        case 1 -> List.of(
            // TCRT-01: 24 paper -> 1e (deterministic)
            createSimpleTrade(Items.PAPER, 24, Items.EMERALD, 1),
            // TCRT-02: 5e -> empty map (deterministic)
            createSimpleTrade(Items.EMERALD, 5, Items.MAP, 1),
            // TCRT-03: 10e -> trial chamber locator (deterministic)
            createLocatorTrade(10, THCItems.TRIAL_CHAMBER_LOCATOR)
        );
        case 2 -> List.of(
            // TCRT-04: 15e -> pillager outpost locator (deterministic)
            createLocatorTrade(15, THCItems.PILLAGER_OUTPOST_LOCATOR),
            // TCRT-05: 1e -> 8 glass panes (deterministic)
            createSimpleTrade(Items.EMERALD, 1, Items.GLASS_PANE, 8),
            // TCRT-06: 3e -> spyglass (deterministic)
            createSimpleTrade(Items.EMERALD, 3, Items.SPYGLASS, 1)
        );
        case 3 -> List.of(
            // TCRT-07: 20e -> nether fortress locator (deterministic)
            createLocatorTrade(20, THCItems.FORTRESS_LOCATOR),
            // TCRT-08: 20e -> bastion locator (deterministic)
            createLocatorTrade(20, THCItems.BASTION_LOCATOR)
        );
        case 4 -> List.of(
            // TCRT-09: 25e -> ancient city locator (deterministic)
            createLocatorTrade(25, THCItems.ANCIENT_CITY_LOCATOR)
        );
        case 5 -> List.of(
            // TCRT-10: 30e -> stronghold locator (deterministic)
            createLocatorTrade(30, THCItems.STRONGHOLD_LOCATOR)
        );
        default -> List.of();
    };
}
```

4. Update getTradesFor() dispatcher to call getCartographerTrades():
```java
if (profession.location().equals(VillagerProfession.CARTOGRAPHER.location())) {
    return getCartographerTrades(level);
}
```

The final getTradesFor() should have all four profession branches returning their respective trades.
  </action>
  <verify>Build succeeds: `cd /mnt/c/home/code/thc && ./gradlew build 2>&1 | tail -30`</verify>
  <done>All 10 cartographer trades implemented (TCRT-01 through TCRT-10) with structure locators</done>
</task>

</tasks>

<verification>
1. Build succeeds: `./gradlew build`
2. Trade counts per profession per level:
   - Butcher: L1=2, L2=2, L3=2, L4=1, L5=1 (total 8)
   - Mason: L1=4, L2=2, L3=2, L4=1, L5=1 (total 10)
   - Cartographer: L1=3, L2=3, L3=2, L4=1, L5=1 (total 10)
3. Cartographer uses THCItems for all 6 structure locators
</verification>

<success_criteria>
- All 8 butcher trade requirements (TBUT-01 through TBUT-08) implemented
- All 10 mason trade requirements (TMAS-01 through TMAS-10) implemented
- All 10 cartographer trade requirements (TCRT-01 through TCRT-10) implemented
- Build passes without errors
- Phase 68 complete: All 37 trades across 4 professions implemented
</success_criteria>

<output>
After completion, create `.planning/phases/68-custom-trade-tables/68-03-SUMMARY.md`
</output>
