---
phase: 85-scaling
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/client/kotlin/thc/client/MobHealthBarConfig.kt
  - src/client/java/thc/mixin/client/VideoSettingsScreenMixin.java
  - src/client/kotlin/thc/THCClient.kt
  - src/main/resources/assets/thc/lang/en_us.json
autonomous: true

must_haves:
  truths:
    - "Video Settings menu contains a Mob Health Bar slider"
    - "Slider adjusts the scale factor used by the mob health bar and mob effects renderers"
    - "Setting persists across game restarts (saved to config file)"
  artifacts:
    - path: "src/client/kotlin/thc/client/MobHealthBarConfig.kt"
      provides: "Client config holder with OptionInstance slider and file persistence for mob health bar scaling"
      contains: "OptionInstance"
    - path: "src/client/java/thc/mixin/client/VideoSettingsScreenMixin.java"
      provides: "Mixin injecting both Effects GUI and Mob Health Bar sliders into Video Settings"
      contains: "MobHealthBarConfig"
  key_links:
    - from: "src/client/java/thc/mixin/client/VideoSettingsScreenMixin.java"
      to: "src/client/kotlin/thc/client/MobHealthBarConfig.kt"
      via: "Mixin reads OptionInstance from config to create widget"
      pattern: "MobHealthBarConfig"
---

<objective>
Add a "Mob Health Bar" scaling slider to Video Settings that controls the rendered size of mob health bars and mob effect icons. The slider persists to a config file, following the exact same pattern as EffectsGuiConfig from Phase 82.

Purpose: Lets players customize the mob health bar size to fit their screen/preference (SCAL-01, SCAL-02).
Output: Config object with OptionInstance slider, extended Video Settings mixin, scale integration point for renderers.
</objective>

<execution_context>
@/home/tack/.claude/get-shit-done/workflows/execute-plan.md
@/home/tack/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

Key references — follow the Phase 82 pattern exactly:
@src/client/kotlin/thc/client/EffectsGuiConfig.kt — TEMPLATE: copy this pattern for MobHealthBarConfig
@src/client/java/thc/mixin/client/VideoSettingsScreenMixin.java — EXTEND: add second slider
@src/client/kotlin/thc/THCClient.kt — Add MobHealthBarConfig.load() call
@src/main/resources/assets/thc/lang/en_us.json — Add translation key
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create MobHealthBarConfig with OptionInstance slider and file persistence</name>
  <files>
    src/client/kotlin/thc/client/MobHealthBarConfig.kt
    src/client/kotlin/thc/THCClient.kt
    src/main/resources/assets/thc/lang/en_us.json
  </files>
  <action>
Create `src/client/kotlin/thc/client/MobHealthBarConfig.kt` as a Kotlin `object`, following the exact pattern of `EffectsGuiConfig.kt`:

1. **OptionInstance slider**: Create `val mobHealthBarScale: OptionInstance<Int>` with:
   - Translation key: `"thc.options.mobHealthBarScale"`
   - Value range: `OptionInstance.IntRange(2, 20)` (represents 2% to 20% of screen width)
   - Display: `Options.genericValueLabel(component, Component.literal("${integer}%"))` pattern
   - Default value: `6` (6% — slightly smaller default than effects GUI since health bars are simpler)
   - On-change callback: `{ save() }`

2. **Accessor function**: `fun getScalePercent(): Int` returns `mobHealthBarScale.get()`

3. **File persistence**: Load/save to `config/thc-mob-health-bar.txt`:
   - `fun load()`: Read single line `mobHealthBarScale:N`, call `mobHealthBarScale.set(N)`. If missing or parse error, keep default.
   - `fun save()`: Write `mobHealthBarScale:N` to file. Called from OptionInstance's onValueUpdate.
   - Config dir: `FabricLoader.getInstance().configDir`

4. **Initialization**: Add `MobHealthBarConfig.load()` call to `THCClient.onInitializeClient()` right after the existing `EffectsGuiConfig.load()` call.

5. **Translation key**: Add to `en_us.json`:
   - `"thc.options.mobHealthBarScale": "Mob Health Bar"`
  </action>
  <verify>
`./gradlew build` succeeds. MobHealthBarConfig object exists with mobHealthBarScale OptionInstance, getScalePercent() accessor, load/save functions. THCClient calls load() on init. Translation key in en_us.json.
  </verify>
  <done>
MobHealthBarConfig holds an OptionInstance slider (2-20 range), persists to config/thc-mob-health-bar.txt, loads on client init. Translation key registered.
  </done>
</task>

<task type="auto">
  <name>Task 2: Extend VideoSettingsScreenMixin to add Mob Health Bar slider</name>
  <files>
    src/client/java/thc/mixin/client/VideoSettingsScreenMixin.java
  </files>
  <action>
Update the existing `VideoSettingsScreenMixin.java` to inject a second slider:

In the `thc$addEffectsGuiScale` method (or rename to `thc$addTHCOptions` for clarity), add the mob health bar slider after the effects GUI slider:

```java
@Inject(method = "addOptions", at = @At("TAIL"))
private void thc$addTHCOptions(CallbackInfo ci) {
    if (this.list != null) {
        this.list.addSmall(EffectsGuiConfig.INSTANCE.getEffectsGuiScale());
        this.list.addSmall(MobHealthBarConfig.INSTANCE.getMobHealthBarScale());
    }
}
```

Add import for `thc.client.MobHealthBarConfig`.

Note: The existing method name `thc$addEffectsGuiScale` can be renamed to `thc$addTHCOptions` since it now handles multiple THC sliders. This is just a mixin method name — no external callers.

The mixin is already registered in `thc.client.mixins.json` — no change needed there.
  </action>
  <verify>
1. `./gradlew build` succeeds
2. Launch game with `./gradlew runClient`, go to Options > Video Settings, scroll to bottom — both "Effects GUI Scaling" and "Mob Health Bar" sliders appear
3. Mob Health Bar slider moves between 2% and 20%
4. Close game, check `config/thc-mob-health-bar.txt` has saved value
5. Relaunch — slider shows persisted value
  </verify>
  <done>
VideoSettingsScreen shows both THC sliders. "Mob Health Bar" slider range 2%-20%. Value persists across restarts via config file. No additional mixin registration needed.
  </done>
</task>

</tasks>

<verification>
1. `./gradlew build` compiles without errors
2. In-game Video Settings contains both "Effects GUI Scaling" and "Mob Health Bar" sliders
3. Mob Health Bar slider displays "Mob Health Bar: N%" for values 2-20
4. Changing slider saves to config/thc-mob-health-bar.txt
5. Restarting game restores saved value
6. MobHealthBarConfig.getScalePercent() returns current slider value (callable from health bar/effects renderers in Phases 83-84)
</verification>

<success_criteria>
- SCAL-01: Video Settings menu includes a "Mob Health Bar" option [slider visible in Video Settings]
- SCAL-02: Scale setting persists across game restarts [config file read/write works]
- Scale factor accessible to both health bar and mob effects renderers [MobHealthBarConfig.getScalePercent() returns int 2-20]
</success_criteria>

<output>
After completion, create `.planning/phases/85-scaling/85-01-SUMMARY.md`
</output>
