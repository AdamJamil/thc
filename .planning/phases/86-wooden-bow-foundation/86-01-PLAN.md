---
phase: 86-wooden-bow-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/main/resources/assets/thc/lang/en_us.json
  - src/main/resources/data/minecraft/recipe/bow.json
  - src/main/java/thc/mixin/ProjectileEntityMixin.java
  - src/main/kotlin/thc/bow/BowType.kt
autonomous: true

must_haves:
  truths:
    - "Vanilla bow displays as 'Wooden Bow' in inventory and tooltips"
    - "Bow recipe is 3 sticks + 3 string (not breeze rods)"
    - "Player arrows lose horizontal speed via drag coefficient per tick"
    - "Old gravity-over-time curve is completely removed"
    - "Arrows carry a bow type tag tracking which bow fired them"
  artifacts:
    - path: "src/main/resources/assets/thc/lang/en_us.json"
      provides: "Wooden Bow display name"
      contains: "item.minecraft.bow"
    - path: "src/main/resources/data/minecraft/recipe/bow.json"
      provides: "Sticks + string recipe"
      contains: "minecraft:stick"
    - path: "src/main/kotlin/thc/bow/BowType.kt"
      provides: "Bow type enum with drag factors"
      exports: ["BowType"]
    - path: "src/main/java/thc/mixin/ProjectileEntityMixin.java"
      provides: "Horizontal drag physics replacing gravity-over-time"
      contains: "drag_coefficient"
  key_links:
    - from: "ProjectileEntityMixin.java"
      to: "BowType.kt"
      via: "bow type lookup for drag factor"
      pattern: "BowType"
---

<objective>
Rename the vanilla bow to "Wooden Bow", change its recipe to sticks + string, create bow type tagging infrastructure, and replace the old gravity-over-time arrow physics with new horizontal drag.

Purpose: Foundation for all bow differentiation in v3.4 -- identity, physics, and tagging infrastructure that phases 87-88 will build on.
Output: Renamed bow with new recipe, per-bow drag factor system, horizontal drag physics on player arrows.
</objective>

<execution_context>
@/home/tack/.claude/get-shit-done/workflows/execute-plan.md
@/home/tack/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/milestones/v3.4-ROADMAP.md
@.planning/phases/86-wooden-bow-foundation/86-CONTEXT.md
@src/main/java/thc/mixin/ProjectileEntityMixin.java
@src/main/resources/assets/thc/lang/en_us.json
@src/main/resources/data/minecraft/recipe/bow.json
@src/main/kotlin/thc/item/THCArrows.kt
@src/main/kotlin/thc/THC.kt
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rename bow to Wooden Bow, change recipe, create BowType infrastructure</name>
  <files>
    src/main/resources/assets/thc/lang/en_us.json
    src/main/resources/data/minecraft/recipe/bow.json
    src/main/kotlin/thc/bow/BowType.kt
  </files>
  <action>
  1. In `en_us.json`, add entry: `"item.minecraft.bow": "Wooden Bow"` (this overrides the vanilla bow display name).

  2. In `data/minecraft/recipe/bow.json`, change the recipe from breeze rods + string to sticks + string. The new recipe should be:
     - Shaped recipe, category "equipment"
     - Key: "S" = minecraft:stick, "T" = minecraft:string
     - Pattern: " ST", "S T", " ST" (standard bow shape with sticks replacing breeze rods)
     - Result: minecraft:bow

  3. Create `src/main/kotlin/thc/bow/BowType.kt`:
     - Enum class `BowType` with values: `WOODEN(dragFactor=0.015)`, `BLAZE(dragFactor=0.015)`, `BREEZE(dragFactor=0.01)`
     - Each enum value has a `dragFactor: Double` property and a `tag: String` property (e.g., "wooden_bow", "blaze_bow", "breeze_bow")
     - Add companion object with:
       - `fun fromBowItem(stack: ItemStack): BowType` that returns WOODEN for vanilla bow (Items.BOW), and will return BLAZE/BREEZE for future custom bow items (placeholder for now, just default to WOODEN)
       - `fun fromTag(tag: String?): BowType?` that looks up by tag string
     - This enum will be used by ProjectileEntityMixin for drag factor and by AbstractArrowMixin for damage multiplier in Plan 02

  NOTE: Do NOT remove Items.BOW from the removedItems set in THC.kt -- bows must remain excluded from loot tables per v1.3 requirement. The recipe change is what makes them obtainable.
  </action>
  <verify>
  `./gradlew build` compiles without errors. Verify en_us.json has the bow entry, bow.json recipe uses sticks, and BowType.kt compiles with all three enum values.
  </verify>
  <done>
  Vanilla bow shows as "Wooden Bow" in-game. Recipe uses 3 sticks + 3 string. BowType enum exists with WOODEN/BLAZE/BREEZE values and drag factors matching PHYS-02 spec.
  </done>
</task>

<task type="auto">
  <name>Task 2: Replace gravity-over-time physics with horizontal drag</name>
  <files>
    src/main/java/thc/mixin/ProjectileEntityMixin.java
  </files>
  <action>
  Rewrite the arrow physics in `ProjectileEntityMixin.java`:

  1. **Remove old gravity-over-time system entirely** (PHYS-03):
     - Remove `thc$spawnX/Y/Z` fields and `thc$spawnRecorded` boolean
     - Remove the spawn recording logic from `thc$applyVelocityBoost`
     - Remove the entire `thc$applyEnhancedGravity` method (the tick HEAD inject that applies downward velocity based on distance)
     - Remove the 20% velocity boost from `thc$applyVelocityBoost` (the `velocity.scale(1.2)` call). Keep the method injection point on `shoot` but repurpose it for bow type tagging

  2. **Add bow type tagging on shoot** (infrastructure for DMG-01):
     - In the existing `shoot` TAIL inject, after confirming owner is ServerPlayer, determine which bow the player is using via `BowType.fromBowItem(player.getUseItem())` (the player's active use item is the bow during shoot)
     - Store the bow type tag as a `@Unique` String field: `thc$bowTypeTag`
     - Also store the drag factor: `thc$bowDragFactor`

  3. **Add horizontal drag per tick** (PHYS-01):
     - Add a `@Unique private int thc$ticksInFlight = 0` counter
     - In the tick HEAD inject (repurpose the old gravity method), for player-shot arrows/projectiles:
       - Increment `thc$ticksInFlight`
       - Only apply drag if `thc$bowDragFactor > 0` (means bow type was set)
       - Calculate: `double dragCoefficient = Math.max(0.8, 1.0 - thc$bowDragFactor * thc$ticksInFlight)`
       - Get current velocity, multiply ONLY horizontal components (x, z) by dragCoefficient, leave y untouched
       - Set the new velocity

  4. **Add a public accessor for the bow type tag**:
     - Add method `public String thc$getBowTypeTag()` returning the stored tag (used by AbstractArrowMixin in Plan 02)
     - This works because AbstractArrow extends Projectile, so the mixin field is accessible via casting

  The drag formula from CONTEXT.md: `drag_coefficient = max(0.8, 1 - bow_drag_factor * ticks_in_flight)` where bow_drag_factor is 0.015 for wooden/blaze, 0.01 for breeze.

  With drag_factor=0.015, the coefficient reaches the 0.8 floor at tick 14 (1 - 0.015*14 = 0.79, clamped to 0.8). This means arrows maintain near-full speed for the first ~7 ticks then progressively slow to 80% horizontal speed cap. This creates a noticeable range falloff without arrows stopping mid-air.
  </action>
  <verify>
  `./gradlew build` compiles without errors. Grep ProjectileEntityMixin.java to confirm: no `thc$spawnX` references remain, no `scale(1.2)` velocity boost, `thc$ticksInFlight` exists, `dragCoefficient` calculation present, `thc$bowDragFactor` used per-tick.
  </verify>
  <done>
  Old gravity-over-time physics fully removed (PHYS-03). New horizontal drag applies per tick using per-bow drag factor (PHYS-01, PHYS-02). Bow type tag stored on shoot for downstream damage logic (DMG-01 infrastructure). Vertical velocity completely untouched by drag system.
  </done>
</task>

</tasks>

<verification>
- `./gradlew build` succeeds
- Language file contains "Wooden Bow" entry
- Bow recipe uses sticks, not breeze rods
- ProjectileEntityMixin has no trace of old physics (no spawnX/Y/Z, no distance-based gravity, no 1.2x velocity boost)
- ProjectileEntityMixin applies horizontal drag with configurable per-bow factor
- BowType enum has correct drag factors: wooden=0.015, blaze=0.015, breeze=0.01
</verification>

<success_criteria>
Vanilla bow renamed to "Wooden Bow" with sticks+string recipe. Arrow physics use horizontal drag instead of gravity-over-time. Bow type tagging infrastructure ready for damage and tipped arrow logic in Plan 02.
</success_criteria>

<output>
After completion, create `.planning/phases/86-wooden-bow-foundation/86-01-SUMMARY.md`
</output>
