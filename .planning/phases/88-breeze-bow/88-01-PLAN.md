---
phase: 88-breeze-bow
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/main/kotlin/thc/bow/BreezeBowItem.kt
  - src/main/kotlin/thc/bow/THCBows.kt
  - src/main/kotlin/thc/bow/BowType.kt
  - src/main/kotlin/thc/THC.kt
  - src/main/java/thc/mixin/AbstractArrowMixin.java
  - src/main/resources/assets/thc/lang/en_us.json
  - src/main/resources/assets/thc/items/breeze_bow.json
  - src/main/resources/assets/thc/models/item/breeze_bow.json
  - src/main/resources/assets/thc/models/item/breeze_bow_pulling_0.json
  - src/main/resources/assets/thc/models/item/breeze_bow_pulling_1.json
  - src/main/resources/assets/thc/models/item/breeze_bow_pulling_2.json
  - src/main/resources/assets/thc/textures/item/breeze_bow.png
  - src/main/resources/assets/thc/textures/item/breeze_bow_pulling_0.png
  - src/main/resources/assets/thc/textures/item/breeze_bow_pulling_1.png
  - src/main/resources/assets/thc/textures/item/breeze_bow_pulling_2.png
  - src/main/resources/data/thc/recipe/breeze_bow.json
autonomous: true

must_haves:
  truths:
    - "Breeze Bow item exists in creative menu and renders with custom texture"
    - "Breeze Bow is craftable with 3 breeze rods + 3 string"
    - "Arrows from Breeze Bow deal 75% final damage (after all other calculations)"
    - "Arrows from Breeze Bow apply regular arrow knockback to monsters (not zeroed out)"
    - "Breeze Bow draws in 0.75x the time of the Wooden Bow"
    - "Non-Support players or players below Stage 2 cannot use the Breeze Bow"
    - "Denied players see an actionbar message explaining why"
    - "Tipped arrows are NOT blocked -- they fire normally and apply direct-hit effect only"
  artifacts:
    - path: "src/main/kotlin/thc/bow/BreezeBowItem.kt"
      provides: "Breeze bow item class with class gating and draw speed"
      min_lines: 30
    - path: "src/main/kotlin/thc/bow/THCBows.kt"
      provides: "Bow registration object (pattern from THCBucklers)"
      exports: ["BREEZE_BOW"]
    - path: "src/main/resources/data/thc/recipe/breeze_bow.json"
      provides: "Crafting recipe for breeze bow"
      contains: "breeze_rod"
    - path: "src/main/resources/assets/thc/items/breeze_bow.json"
      provides: "Item definition for texture rendering"
      contains: "thc:item/breeze_bow"
    - path: "src/main/resources/assets/thc/lang/en_us.json"
      provides: "Breeze Bow display name"
      contains: "Breeze Bow"
  key_links:
    - from: "BreezeBowItem.kt"
      to: "BowType.kt"
      via: "BowType.BREEZE enum value for identification"
      pattern: "BowType\\.BREEZE"
    - from: "AbstractArrowMixin.java"
      to: "BowType.kt"
      via: "bow type tag lookup for 75% damage multiplier"
      pattern: "breeze_bow"
    - from: "BreezeBowItem.kt"
      to: "ClassManager/StageManager"
      via: "class gate check on use"
      pattern: "SUPPORT|Stage"
---

<objective>
Add the Breeze Bow as a Support-class weapon with 75% damage, regular knockback, fast draw speed (0.75x), and Support Stage 2+ class gating.

Purpose: Complete the third bow tier for v3.4, giving Support players a fast-draw utility bow with knockback for crowd control.
Output: Working Breeze Bow item with textures, recipe, damage profile, knockback, draw speed, and class gating.
</objective>

<execution_context>
@/home/tack/.claude/get-shit-done/workflows/execute-plan.md
@/home/tack/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/milestones/v3.4-ROADMAP.md
@.planning/phases/88-breeze-bow/88-CONTEXT.md
@.planning/phases/86-wooden-bow-foundation/86-01-SUMMARY.md
@.planning/phases/87-blaze-bow/87-01-SUMMARY.md

@src/main/kotlin/thc/bow/BowType.kt
@src/main/java/thc/mixin/AbstractArrowMixin.java
@src/main/java/thc/mixin/ProjectileEntityMixin.java
@src/main/java/thc/boon/BoonGate.java
@src/main/java/thc/playerclass/PlayerClass.java
@src/main/kotlin/thc/item/THCBucklers.kt
@src/main/kotlin/thc/THC.kt
@src/main/resources/assets/thc/lang/en_us.json
@src/main/resources/thc.mixins.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Breeze Bow item, textures, recipe, and registration</name>
  <files>
    src/main/kotlin/thc/bow/BreezeBowItem.kt
    src/main/kotlin/thc/bow/THCBows.kt
    src/main/kotlin/thc/bow/BowType.kt
    src/main/kotlin/thc/THC.kt
    src/main/resources/assets/thc/lang/en_us.json
    src/main/resources/assets/thc/items/breeze_bow.json
    src/main/resources/assets/thc/models/item/breeze_bow.json
    src/main/resources/assets/thc/models/item/breeze_bow_pulling_0.json
    src/main/resources/assets/thc/models/item/breeze_bow_pulling_1.json
    src/main/resources/assets/thc/models/item/breeze_bow_pulling_2.json
    src/main/resources/assets/thc/textures/item/breeze_bow.png
    src/main/resources/assets/thc/textures/item/breeze_bow_pulling_0.png
    src/main/resources/assets/thc/textures/item/breeze_bow_pulling_1.png
    src/main/resources/assets/thc/textures/item/breeze_bow_pulling_2.png
    src/main/resources/data/thc/recipe/breeze_bow.json
  </files>
  <action>
  Follow the EXACT pattern established by Phase 87's Blaze Bow for item registration, textures, and recipe. The Breeze Bow is structurally identical to the Blaze Bow but with different class gating and mechanics.

  1. **Create `BreezeBowItem.kt`** in `src/main/kotlin/thc/bow/`:
     - Extend `BowItem` (net.minecraft.world.item.BowItem)
     - Override `use()` to add class gating: check if player is Support class AND has boon level >= 2 (Stage 2+). Use `ClassManager.getClass(player)` and `StageManager.getBoonLevel(player)` following the BoonGate pattern
     - If gating fails, show actionbar message: "The bow gusts are beyond your control." (use `player.displayClientMessage(Component.literal("..."), true)`)
     - If gating fails, return `InteractionResult.FAIL` (do not start drawing)
     - If gating passes, call `super.use()` to start normal bow draw
     - Override draw speed to 0.75x the Wooden Bow draw time. The vanilla bow full draw is 20 ticks (1 second). At 0.75x, the Breeze Bow should draw in 15 ticks. Override `getUseDuration()` to return 57600 (same as vanilla -- this is max use duration, not draw time). Instead, adjust the draw progress calculation. Check how Phase 87 handled draw speed modification for the Blaze Bow (1.5x slower) and apply the inverse pattern for 0.75x faster
     - The draw speed modification approach depends on Phase 87's implementation. If Phase 87 overrides a method or uses a mixin for draw speed, follow the same pattern but with a 0.75x multiplier instead of 1.5x

  2. **Register in `THCBows.kt`** (or equivalent registration file created by Phase 87):
     - If Phase 87 created a `THCBows.kt` registration object, add `BREEZE_BOW` there following the same pattern as `BLAZE_BOW`
     - If Phase 87 used a different registration approach, follow that same approach
     - Register with id "breeze_bow", stacksTo(1), durability matching vanilla bow (384)
     - Add to combat creative tab

  3. **Update `BowType.kt`**:
     - Ensure BowType.BREEZE has a reference to the breeze bow item (if Phase 86/87 added item references to the enum)
     - Update `fromBowItem()` to return `BREEZE` when the stack is a Breeze Bow item

  4. **Update `THC.kt`**:
     - Call `THCBows.init()` if Phase 87 hasn't already added this call (it likely has for the Blaze Bow -- just verify it exists)

  5. **Create asset files** (CRITICAL -- MC 1.21+ requires all three: items, models, textures):

     a. `assets/thc/items/breeze_bow.json` -- item definition with pulling state model overrides. Follow the vanilla bow's item definition pattern which uses `minecraft:condition/using_item` and `minecraft:property/use_duration` for pulling states. Check how Phase 87's blaze_bow.json item definition handles this and replicate it

     b. `assets/thc/models/item/breeze_bow.json` -- base model, parent `minecraft:item/generated`, layer0 `thc:item/breeze_bow`

     c. `assets/thc/models/item/breeze_bow_pulling_0.json` through `_pulling_2.json` -- pulling animation frames, parent `minecraft:item/generated`, each with their respective layer0 texture

     d. **Textures**: Create 4 placeholder PNG textures (16x16 pixels each):
        - `breeze_bow.png` -- idle state. Use a light blue/cyan color scheme (breeze theme). Create a simple bow shape similar to vanilla but with a breeze/wind aesthetic (lighter, airier)
        - `breeze_bow_pulling_0.png` -- early draw
        - `breeze_bow_pulling_1.png` -- mid draw
        - `breeze_bow_pulling_2.png` -- full draw
        - Use imagemagick or similar to generate simple placeholder textures if needed. A solid-color bow silhouette is acceptable

  6. **Recipe** -- `data/thc/recipe/breeze_bow.json`:
     ```json
     {
       "type": "minecraft:crafting_shaped",
       "category": "equipment",
       "key": {
         "R": "minecraft:breeze_rod",
         "S": "minecraft:string"
       },
       "pattern": [
         " RS",
         "R S",
         " RS"
       ],
       "result": {
         "id": "thc:breeze_bow"
       }
     }
     ```

  7. **Language file** -- add `"item.thc.breeze_bow": "Breeze Bow"` to `en_us.json`

  NOTE: Tipped arrows are NOT blocked for the Breeze Bow (per locked decision). They fire normally and apply direct-hit effects. Do NOT add any tipped arrow restriction logic. Do NOT add splash AoE behavior (deferred).
  </action>
  <verify>
  `./gradlew build` compiles without errors. Verify: breeze_bow.json item definition exists, 4 model files exist, 4 texture files exist, recipe file exists, en_us.json contains "Breeze Bow", BreezeBowItem.kt has class gating check for Support + Stage 2.
  </verify>
  <done>
  Breeze Bow item registered and craftable (ITEM-05, ITEM-06). Custom textures with pulling states render in inventory. Recipe: 3 breeze rods + 3 string. Non-Support or sub-Stage-2 players see "The bow gusts are beyond your control." and cannot draw (GATE-02). Draw speed is 0.75x wooden bow (MECH-02).
  </done>
</task>

<task type="auto">
  <name>Task 2: Breeze Bow damage profile (75%) and knockback preservation</name>
  <files>
    src/main/java/thc/mixin/AbstractArrowMixin.java
  </files>
  <action>
  Modify `AbstractArrowMixin.java` to handle Breeze Bow arrow damage and knockback:

  1. **Damage reduction (DMG-02)**:
     - In `thc$applyArrowHitEffects`, after the existing player arrow damage reduction logic, check the bow type tag on the arrow (stored by ProjectileEntityMixin during shoot -- use `((ProjectileEntityMixin)(Object)self).thc$getBowTypeTag()` or however Phase 86 exposed the tag accessor)
     - If bow type tag equals "breeze_bow", apply an additional 0.75x multiplier to the already-reduced damage. The existing code reduces damage to `baseDamage * 0.13 * classMultiplier`. For Breeze Bow: `baseDamage * 0.13 * classMultiplier * 0.75`
     - Check how Phase 87 implemented the Blaze Bow damage profile (100% -- no additional multiplier). Follow the same conditional pattern but with 0.75 instead
     - If Phase 86's Plan 02 introduced a per-bow-type damage multiplier system (e.g., `BowType.getDamageMultiplier()`), use that system. If not, add the conditional check directly

  2. **Knockback preservation (DMG-04)**:
     - Currently, `thc$removeArrowKnockback` at the TAIL of `onHitEntity` zeroes out horizontal velocity for all player-shot arrows hitting monsters. For Breeze Bow arrows, this knockback removal must be SKIPPED
     - In the TAIL inject, check the bow type tag. If it's "breeze_bow", return early WITHOUT zeroing the velocity. This lets the vanilla arrow knockback apply naturally
     - The check should be: `if ("breeze_bow".equals(thc$bowTypeTag)) return;` placed after the ServerPlayer check but before the velocity zeroing
     - Note: the bow type tag is accessible from the mixin fields set by ProjectileEntityMixin (both AbstractArrowMixin and ProjectileEntityMixin operate on the same entity). Check how Phase 86/87 accesses the tag from AbstractArrowMixin and follow that pattern

  Important: Do NOT add any splash AoE behavior for tipped arrows. Do NOT modify knockback for non-Breeze bows. The knockback that Breeze Bow arrows apply is vanilla arrow knockback -- no custom knockback logic needed.
  </action>
  <verify>
  `./gradlew build` compiles without errors. Grep AbstractArrowMixin.java to confirm: "breeze_bow" string appears in damage section with 0.75 multiplier, "breeze_bow" check exists in knockback removal section with early return.
  </verify>
  <done>
  Breeze Bow arrows deal 75% of final damage (DMG-02). Breeze Bow arrows preserve vanilla knockback on monsters instead of having it zeroed out (DMG-04). All other bow types continue with existing knockback removal behavior.
  </done>
</task>

</tasks>

<verification>
- `./gradlew build` succeeds with no errors
- Breeze Bow item exists and renders with custom texture in creative menu
- Recipe (3 breeze rods + 3 string) produces a Breeze Bow
- Non-Support players see "The bow gusts are beyond your control." when trying to use
- Support Stage 2+ players can draw and fire the Breeze Bow
- Breeze Bow draws noticeably faster than the Wooden Bow (0.75x time)
- Breeze Bow arrows deal less damage than Wooden Bow arrows (75% multiplier on top of existing reduction)
- Breeze Bow arrows knock targets back (unlike Wooden/Blaze bow arrows which zero knockback)
- Tipped arrows fire normally from Breeze Bow (no restriction, no splash AoE)
</verification>

<success_criteria>
Breeze Bow is a fully functional Support-class weapon: craftable, class-gated, fast-drawing, with 75% damage and preserved knockback. All 6 requirements (ITEM-05, ITEM-06, DMG-02, DMG-04, MECH-02, GATE-02) are satisfied. No splash AoE behavior present (deferred).
</success_criteria>

<output>
After completion, create `.planning/phases/88-breeze-bow/88-01-SUMMARY.md`
</output>
